\hypertarget{classmdt_modbus_tcp_port_manager}{
\section{mdtModbusTcpPortManager Class Reference}
\label{classmdt_modbus_tcp_port_manager}\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
}


MODBUS/TCP port manager.  




{\ttfamily \#include $<$mdtModbusTcpPortManager.h$>$}



Inheritance diagram for mdtModbusTcpPortManager:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{classmdt_modbus_tcp_port_manager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdtModbusTcpPortManager:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=254pt]{classmdt_modbus_tcp_port_manager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}{fromThreadNewFrameReaden} ()
\begin{DoxyCompactList}\small\item\em Called by the thread whenn a complete frame was readen. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}{mdtModbusTcpPortManager} (QObject $\ast$parent=0)
\begin{DoxyCompactList}\small\item\em Construct a MODBUS/TCP port manager. \end{DoxyCompactList}\item 
\hyperlink{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}{$\sim$mdtModbusTcpPortManager} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
QList$<$ \hyperlink{classmdt_port_info}{mdtPortInfo} $\ast$ $>$ \hyperlink{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}{scan} (const QStringList \&hosts, int timeout=500)
\begin{DoxyCompactList}\small\item\em Scan for available hosts with a MODBUS/TCP compatible device attached. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_modbus_tcp_port_manager_addd9b9336417aa964eea91ca2f95d26e}{writeData} (QByteArray pdu)
\begin{DoxyCompactList}\small\item\em Write data by copy. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_modbus_tcp_port_manager_a043a1cb15b045037f97eebd4ffe6cef8}{writeData} (const QByteArray \&pdu, quint16 transactionId)
\begin{DoxyCompactList}\small\item\em Write data by copy. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_modbus_tcp_port_manager_a233d2acf67dca192fb36ce407d90bfb7}{waitReadenFrame} (int timeout=500)
\begin{DoxyCompactList}\small\item\em Wait until a complete frame is available. \end{DoxyCompactList}\item 
QHash$<$ quint16, QByteArray $>$ \& \hyperlink{classmdt_modbus_tcp_port_manager_a6dd3c77348286dfd323ae8a1becad33c}{readenFrames} ()
\begin{DoxyCompactList}\small\item\em Get all readen data (PDUs) \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
MODBUS/TCP port manager. 

This is the simplest way to use the MODBUS/TCP API.

All needed object are created by constructor. To alter configuration, use \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{config()}. To access the tcp port object, use port().

Use \hyperlink{classmdt_port_manager_af1fb103ffafc227337a59c7e82f44fbc}{start()} to begin read/write and stop to end.

References:
\begin{DoxyItemize}
\item MODBUS Application Protocol Specification V1.1b
\item \href{http://www.Modbus-IDA.org}{\tt http://www.Modbus-\/IDA.org} 
\end{DoxyItemize}

Definition at line 45 of file mdtModbusTcpPortManager.h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{mdtModbusTcpPortManager}]{\setlength{\rightskip}{0pt plus 5cm}mdtModbusTcpPortManager::mdtModbusTcpPortManager (
\begin{DoxyParamCaption}
\item[{QObject $\ast$}]{parent = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}


Construct a MODBUS/TCP port manager. 

Creates a \hyperlink{classmdt_port_config}{mdtPortConfig}, a \hyperlink{classmdt_tcp_socket}{mdtTcpSocket}, and thread object. 

Definition at line 35 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!$\sim$mdtModbusTcpPortManager@{$\sim$mdtModbusTcpPortManager}}
\index{$\sim$mdtModbusTcpPortManager@{$\sim$mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{$\sim$mdtModbusTcpPortManager}]{\setlength{\rightskip}{0pt plus 5cm}mdtModbusTcpPortManager::$\sim$mdtModbusTcpPortManager (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}


Destructor. 

Stop the manager (if running), and close the port (if open). All internal objects (port, config and threads) are deleted here. 

Definition at line 55 of file mdtModbusTcpPortManager.cpp.



\subsection{Member Function Documentation}
\hypertarget{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!fromThreadNewFrameReaden@{fromThreadNewFrameReaden}}
\index{fromThreadNewFrameReaden@{fromThreadNewFrameReaden}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{fromThreadNewFrameReaden}]{\setlength{\rightskip}{0pt plus 5cm}void mdtModbusTcpPortManager::fromThreadNewFrameReaden (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual, slot\mbox{]}}}}
\label{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}


Called by the thread whenn a complete frame was readen. 



\begin{Desc}
\item[\hyperlink{todo__todo000012}{Todo}]Error on incomplete frame \end{Desc}




Reimplemented from \hyperlink{classmdt_port_manager_a4fcc8f0699b655156e661bb3de6056cc}{mdtPortManager}.



Definition at line 198 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a6dd3c77348286dfd323ae8a1becad33c}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!readenFrames@{readenFrames}}
\index{readenFrames@{readenFrames}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{readenFrames}]{\setlength{\rightskip}{0pt plus 5cm}QHash$<$ quint16, QByteArray $>$ \& mdtModbusTcpPortManager::readenFrames (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a6dd3c77348286dfd323ae8a1becad33c}


Get all readen data (PDUs) 

Get a copy of all currently available data. Note: the list of data must be cleared explicitly with QHash::clear() after data are used. (or remove each item with, for.ex. QHash::take() ) 

Reimplemented from \hyperlink{classmdt_port_manager_a4843ac996aa5da0df5dc8104ba41b4d8}{mdtPortManager}.



Definition at line 183 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!scan@{scan}}
\index{scan@{scan}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{scan}]{\setlength{\rightskip}{0pt plus 5cm}QList$<$ {\bf mdtPortInfo} $\ast$ $>$ mdtModbusTcpPortManager::scan (
\begin{DoxyParamCaption}
\item[{const QStringList \&}]{hosts, }
\item[{int}]{timeout = {\ttfamily 500}}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}


Scan for available hosts with a MODBUS/TCP compatible device attached. 


\begin{DoxyParams}{Parameters}
{\em hosts} & A list of hosts to scan. Each host must be set with format hostname:port, or ip:port. Note that MODBUS/TCP default port is 502. \\
\hline
{\em timeout} & Maximum wait time \mbox{[}ms\mbox{]}. Must be a multiple of 50 \mbox{[}ms\mbox{]}\\
\hline
\end{DoxyParams}
Note that returned list must be freed by user after usage. (for.ex. with qDeletAll() and QList::clear() ).

\begin{DoxyPrecond}{Precondition}
Manager must no running 
\end{DoxyPrecond}


\hyperlink{classmdt_device_info}{mdtDeviceInfo} $\ast$deviceInfo; 



Definition at line 63 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a233d2acf67dca192fb36ce407d90bfb7}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!waitReadenFrame@{waitReadenFrame}}
\index{waitReadenFrame@{waitReadenFrame}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{waitReadenFrame}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtModbusTcpPortManager::waitReadenFrame (
\begin{DoxyParamCaption}
\item[{int}]{timeout = {\ttfamily 500}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classmdt_modbus_tcp_port_manager_a233d2acf67dca192fb36ce407d90bfb7}


Wait until a complete frame is available. 

This method will return when a complete frame was readen. This is usefull for query/answer protocols.

Internally, a couple of sleep and process event are called, so Qt's event loop will not be broken.


\begin{DoxyParams}{Parameters}
{\em timeout} & Maximum wait time \mbox{[}ms\mbox{]}. Must be a multiple of 50 \mbox{[}ms\mbox{]} \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True if Ok, false on timeout 
\end{DoxyReturn}


Reimplemented from \hyperlink{classmdt_port_manager_a44ca338c8c56893612301e09d2ee6e88}{mdtPortManager}.



Definition at line 167 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a043a1cb15b045037f97eebd4ffe6cef8}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!writeData@{writeData}}
\index{writeData@{writeData}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{writeData}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtModbusTcpPortManager::writeData (
\begin{DoxyParamCaption}
\item[{const QByteArray \&}]{pdu, }
\item[{quint16}]{transactionId}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a043a1cb15b045037f97eebd4ffe6cef8}


Write data by copy. 

This is the same as \hyperlink{classmdt_modbus_tcp_port_manager_addd9b9336417aa964eea91ca2f95d26e}{writeData(QByteArray)} , but you can specify a transaction ID.


\begin{DoxyParams}{Parameters}
{\em pdu} & MODBUS PDU (see the MODBUS Application Protocol Specification for details) \\
\hline
{\em transactionId} & Transaction identifier. Will be encoded in MBAP header. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True on success. 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{setPort()} before use of this method. 
\end{DoxyPrecond}


Definition at line 160 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_addd9b9336417aa964eea91ca2f95d26e}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!writeData@{writeData}}
\index{writeData@{writeData}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{writeData}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtModbusTcpPortManager::writeData (
\begin{DoxyParamCaption}
\item[{QByteArray}]{pdu}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classmdt_modbus_tcp_port_manager_addd9b9336417aa964eea91ca2f95d26e}


Write data by copy. 

Data will be encoded regarding MODBUS/TCP standard and passed to the mdtTcpSocket's write queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.

Note that the transaction ID is incremented a each write request. If you want to specify it, use writeData(QByteArray, quint16) .


\begin{DoxyParams}{Parameters}
{\em pdu} & MODBUS PDU (see the MODBUS Application Protocol Specification for details) \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
True on success. If the maximum of authorized transactions are reached, false is returned. Note: internally, the writeFramesPool size of \hyperlink{classmdt_abstract_port}{mdtAbstractPort} is used to fix this, and this is configurable in \hyperlink{classmdt_port_config}{mdtPortConfig}. See \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{mdtPortManager::config()} . 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{setPort()} before use of this method. 
\end{DoxyPrecond}


frame-\/$>$setWaitAnAnswer(false);

\begin{Desc}
\item[\hyperlink{todo__todo000011}{Todo}]Handle this ? \end{Desc}




Reimplemented from \hyperlink{classmdt_port_manager_a6d3cc4e522326e2a6ca0da401ae58271}{mdtPortManager}.



Definition at line 128 of file mdtModbusTcpPortManager.cpp.



The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
src/mdtport/mdtModbusTcpPortManager.h\item 
src/mdtport/mdtModbusTcpPortManager.cpp\end{DoxyCompactItemize}
