\hypertarget{classmdt_port_lock}{\section{mdt\-Port\-Lock Class Reference}
\label{classmdt_port_lock}\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}}
}


N\-O\-T\-E\-:  




{\ttfamily \#include $<$mdt\-Port\-Lock.\-h$>$}

\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_port_lock_a90323fa64e81c96e4db36253845262b8}{mdt\-Port\-Lock} ()
\item 
\hyperlink{classmdt_port_lock_ac8b6e1a528bff0d90b0efec4dc7fd8fd}{$\sim$mdt\-Port\-Lock} ()
\item 
int \hyperlink{classmdt_port_lock_a25e9a2cb8a10069fae75c76b6809c27f}{open\-Locked} (const Q\-String \&port\-Name, int flags)
\begin{DoxyCompactList}\small\item\em Open a port locked. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_lock_a60b65f02d57568dc36c5e918aa5357a6}{unlock} ()
\begin{DoxyCompactList}\small\item\em Unlock the port. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_port_lock_a07a7d13509147d65dde89e95ac343eb2}{is\-Locked} ()
\begin{DoxyCompactList}\small\item\em Returns true if port is locked by current instance. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_port_lock_a739a8cedebb1a32e122c7e451f0cfe98}{is\-Locked\-By\-Another} ()
\begin{DoxyCompactList}\small\item\em Returns true if port is locked by another instance. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
N\-O\-T\-E\-: 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000019}{Todo}]Implement U\-U\-C\-P format in L\-C\-K.. files \end{DoxyRefDesc}


Open a port and lock it

On Linux (or all P\-O\-S\-I\-X ?) system, file locking is avaliable with fcntl(). But several applications uses L\-C\-K..name for locking.

This class will try to find if a port is allready locked using L\-C\-K..name system in several directories (/var/lock, /tmp, ...).

If nothing is found, then port will be opened, and several lockfiles created. The port is then locked with fcntl(). 

Definition at line 45 of file mdt\-Port\-Lock.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_port_lock_a90323fa64e81c96e4db36253845262b8}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!mdt\-Port\-Lock@{mdt\-Port\-Lock}}
\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{mdt\-Port\-Lock}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Port\-Lock\-::mdt\-Port\-Lock (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_a90323fa64e81c96e4db36253845262b8}


Definition at line 30 of file mdt\-Port\-Lock.\-cpp.

\hypertarget{classmdt_port_lock_ac8b6e1a528bff0d90b0efec4dc7fd8fd}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!$\sim$mdt\-Port\-Lock@{$\sim$mdt\-Port\-Lock}}
\index{$\sim$mdt\-Port\-Lock@{$\sim$mdt\-Port\-Lock}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{$\sim$mdt\-Port\-Lock}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Port\-Lock\-::$\sim$mdt\-Port\-Lock (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_ac8b6e1a528bff0d90b0efec4dc7fd8fd}


Definition at line 39 of file mdt\-Port\-Lock.\-cpp.



References unlock().



\subsection{Member Function Documentation}
\hypertarget{classmdt_port_lock_a07a7d13509147d65dde89e95ac343eb2}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!is\-Locked@{is\-Locked}}
\index{is\-Locked@{is\-Locked}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{is\-Locked}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Port\-Lock\-::is\-Locked (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_a07a7d13509147d65dde89e95ac343eb2}


Returns true if port is locked by current instance. 



Definition at line 127 of file mdt\-Port\-Lock.\-cpp.

\hypertarget{classmdt_port_lock_a739a8cedebb1a32e122c7e451f0cfe98}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!is\-Locked\-By\-Another@{is\-Locked\-By\-Another}}
\index{is\-Locked\-By\-Another@{is\-Locked\-By\-Another}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{is\-Locked\-By\-Another}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Port\-Lock\-::is\-Locked\-By\-Another (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_a739a8cedebb1a32e122c7e451f0cfe98}


Returns true if port is locked by another instance. 



Definition at line 132 of file mdt\-Port\-Lock.\-cpp.

\hypertarget{classmdt_port_lock_a25e9a2cb8a10069fae75c76b6809c27f}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!open\-Locked@{open\-Locked}}
\index{open\-Locked@{open\-Locked}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{open\-Locked}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Port\-Lock\-::open\-Locked (
\begin{DoxyParamCaption}
\item[{const Q\-String \&}]{port\-Name, }
\item[{int}]{flags}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_a25e9a2cb8a10069fae75c76b6809c27f}


Open a port locked. 

At first, the lock file name will be buit for each lock directories found (searching in /tmp, /var/lock). Then, if no lock file is found, the port will be opened with open(). Just after open, the port will be locked with fcntl().


\begin{DoxyParams}{Parameters}
{\em port\-Name} & Path to port to open (f.\-ex. /dev/tty\-S0) \\
\hline
{\em flags} & Flags are simply passed to open() syscall (see open() man for details). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
File descriptor returned by open() , or -\/1 on error. 
\end{DoxyReturn}


Definition at line 44 of file mdt\-Port\-Lock.\-cpp.



References mdt\-Error\-::commit(), mdt\-Error\-::\-Error, mdt\-Error\-::\-Info, M\-D\-T\-\_\-\-E\-R\-R\-O\-R\-\_\-\-S\-E\-T\-\_\-\-S\-R\-C, M\-D\-T\-\_\-\-P\-O\-R\-T\-\_\-\-I\-O\-\_\-\-E\-R\-R\-O\-R, and mdt\-Error\-::set\-System\-Error().

\hypertarget{classmdt_port_lock_a60b65f02d57568dc36c5e918aa5357a6}{\index{mdt\-Port\-Lock@{mdt\-Port\-Lock}!unlock@{unlock}}
\index{unlock@{unlock}!mdtPortLock@{mdt\-Port\-Lock}}
\subsubsection[{unlock}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Port\-Lock\-::unlock (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_port_lock_a60b65f02d57568dc36c5e918aa5357a6}


Unlock the port. 

Will remove lockfiles and unlock port with fcntl().

Note\-: use close() if file is not used later, this is not done by this method. 

Definition at line 113 of file mdt\-Port\-Lock.\-cpp.



Referenced by $\sim$mdt\-Port\-Lock().



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/mdtport/linux/\hyperlink{mdt_port_lock_8h}{mdt\-Port\-Lock.\-h}\item 
src/mdtport/linux/\hyperlink{mdt_port_lock_8cpp}{mdt\-Port\-Lock.\-cpp}\end{DoxyCompactItemize}
