\hypertarget{classmdt_usbtmc_port_manager}{\section{mdt\-Usbtmc\-Port\-Manager Class Reference}
\label{classmdt_usbtmc_port_manager}\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}}
}


U\-S\-B\-T\-M\-C port manager.  




{\ttfamily \#include $<$mdt\-Usbtmc\-Port\-Manager.\-h$>$}



Inheritance diagram for mdt\-Usbtmc\-Port\-Manager\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=202pt]{classmdt_usbtmc_port_manager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdt\-Usbtmc\-Port\-Manager\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classmdt_usbtmc_port_manager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_usbtmc_port_manager_aca42b343ae1f6a324e6e45968f03bbea}{from\-Thread\-New\-Frame\-Readen} ()
\begin{DoxyCompactList}\small\item\em Called by the thread whenn a frame was readen. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_usbtmc_port_manager_a99a24e4360e70ffc63677dbe888513f7}{mdt\-Usbtmc\-Port\-Manager} (\hyperlink{class_q_object}{Q\-Object} $\ast$parent=0)
\begin{DoxyCompactList}\small\item\em Construct a U\-S\-B\-T\-M\-C port manager. \end{DoxyCompactList}\item 
\hyperlink{classmdt_usbtmc_port_manager_aad6b2eef9b5cfb5c324affb6962a463b}{$\sim$mdt\-Usbtmc\-Port\-Manager} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
Q\-List$<$ \hyperlink{classmdt_port_info}{mdt\-Port\-Info} $\ast$ $>$ \hyperlink{classmdt_usbtmc_port_manager_a992d1227810186d3c7dc166452e2e3b6}{scan} ()
\begin{DoxyCompactList}\small\item\em Scan for available ports with a U\-S\-B\-T\-M\-C compatible device attached. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{is\-Ready} () const 
\begin{DoxyCompactList}\small\item\em Check if port manager is ready. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_af6abc4a3693fc386a12f346f57282c11}{send\-Command} (const Q\-Byte\-Array \&command)
\begin{DoxyCompactList}\small\item\em Send a command to device. \end{DoxyCompactList}\item 
Q\-Byte\-Array \hyperlink{classmdt_usbtmc_port_manager_acbbb8539c54034989b2ea6f6071e90bf}{send\-Query} (const Q\-Byte\-Array \&query)
\begin{DoxyCompactList}\small\item\em Send a query to device. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_a205901666c797055bee1902bd1e1e09c}{send\-Data} (\hyperlink{classmdt_port_transaction}{mdt\-Port\-Transaction} $\ast$transaction)
\begin{DoxyCompactList}\small\item\em Send data on port. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_a6d566c68ddeb7c7ca14b5c70ae784efc}{send\-Data} (const Q\-Byte\-Array \&data)
\begin{DoxyCompactList}\small\item\em Write data by copy. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_a2920bdd6b189f198f132de9e5555a78b}{send\-Read\-Request} (\hyperlink{classmdt_port_transaction}{mdt\-Port\-Transaction} $\ast$transaction)
\begin{DoxyCompactList}\small\item\em Send a read request to device. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_ab1604a1c8f2e9192714d039dbf9a5158}{send\-Read\-Request} (bool enqueue\-Response)
\begin{DoxyCompactList}\small\item\em Send a read request to device. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_usbtmc_port_manager_a7bcc280bd4a26ed523832550b1e61553}{send\-Read\-Status\-Byte\-Request} ()
\begin{DoxyCompactList}\small\item\em Send a R\-E\-A\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-B\-Y\-T\-E request thru the control endpoint. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
U\-S\-B\-T\-M\-C port manager. 

\begin{DoxyRefDesc}{Bug}
\item[\hyperlink{bug__bug000001}{Bug}]abort\-Bulk\-In() does not work properly \end{DoxyRefDesc}


This is the easiest way to use the U\-S\-B\-T\-M\-C port A\-P\-I.

All needed object are created by constructor. To alter configuration, use \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{config()}. To access the usb port object, use port().

Use \hyperlink{classmdt_usb_port_manager_ac656805c6de08c9c6a2487291cf3f347}{start()} to begin read/write and stop to end. 

Definition at line 44 of file mdt\-Usbtmc\-Port\-Manager.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_usbtmc_port_manager_a99a24e4360e70ffc63677dbe888513f7}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}}
\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{mdt\-Usbtmc\-Port\-Manager}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Usbtmc\-Port\-Manager\-::mdt\-Usbtmc\-Port\-Manager (
\begin{DoxyParamCaption}
\item[{{\bf Q\-Object} $\ast$}]{parent = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_a99a24e4360e70ffc63677dbe888513f7}


Construct a U\-S\-B\-T\-M\-C port manager. 

Create a thread and setup port. 

Definition at line 37 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::add\-Thread(), mdt\-Abstract\-Port\-::config(), mdt\-Frame\-::\-F\-T\-\_\-\-U\-S\-B\-T\-M\-C, mdt\-Port\-Manager\-::pv\-Port, mdt\-Port\-Manager\-::pv\-Threads, mdt\-Port\-Manager\-::set\-Current\-Transaction\-Id(), mdt\-Port\-Config\-::set\-Frame\-Type(), mdt\-Port\-Manager\-::set\-Keep\-Transactions\-Done(), mdt\-Usb\-Port\-Thread\-::set\-Port(), mdt\-Port\-Config\-::set\-Read\-Timeout(), and mdt\-Usb\-Port\-Thread\-::usb\-Port().

\hypertarget{classmdt_usbtmc_port_manager_aad6b2eef9b5cfb5c324affb6962a463b}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!$\sim$mdt\-Usbtmc\-Port\-Manager@{$\sim$mdt\-Usbtmc\-Port\-Manager}}
\index{$\sim$mdt\-Usbtmc\-Port\-Manager@{$\sim$mdt\-Usbtmc\-Port\-Manager}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{$\sim$mdt\-Usbtmc\-Port\-Manager}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Usbtmc\-Port\-Manager\-::$\sim$mdt\-Usbtmc\-Port\-Manager (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_aad6b2eef9b5cfb5c324affb6962a463b}


Destructor. 

Stop the manager (if running), and close the port (if open). All internal objects (port, config and threads) are deleted here. 

Definition at line 68 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



\subsection{Member Function Documentation}
\hypertarget{classmdt_usbtmc_port_manager_aca42b343ae1f6a324e6e45968f03bbea}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!from\-Thread\-New\-Frame\-Readen@{from\-Thread\-New\-Frame\-Readen}}
\index{from\-Thread\-New\-Frame\-Readen@{from\-Thread\-New\-Frame\-Readen}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{from\-Thread\-New\-Frame\-Readen}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usbtmc\-Port\-Manager\-::from\-Thread\-New\-Frame\-Readen (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [slot]}}}\label{classmdt_usbtmc_port_manager_aca42b343ae1f6a324e6e45968f03bbea}


Called by the thread whenn a frame was readen. 

\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000050}{Todo}]On complete frame, check b\-Tag/b\-Tag\-Inverse, and I\-N\-I\-T\-I\-A\-T\-E\-\_\-\-C\-L\-E\-A\-R on error. $<$-\/ Should be done in thread.. \end{DoxyRefDesc}


Definition at line 297 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::add\-Transaction\-Done(), mdt\-Frame\-Usb\-Tmc\-::b\-Tag(), mdt\-Error\-::commit(), mdt\-Port\-Manager\-::commit\-Frames(), mdt\-Frame\-Usb\-Tmc\-::\-D\-E\-V\-\_\-\-D\-E\-P\-\_\-\-M\-S\-G\-\_\-\-I\-N, mdt\-Usb\-Port\-::expected\-Bulk\-Inb\-Tags(), mdt\-Frame\-::is\-Complete(), mdt\-Port\-Manager\-::lock\-Port\-Mutex(), M\-D\-T\-\_\-\-E\-R\-R\-O\-R\-\_\-\-S\-E\-T\-\_\-\-S\-R\-C, M\-D\-T\-\_\-\-U\-S\-B\-\_\-\-I\-O\-\_\-\-E\-R\-R\-O\-R, mdt\-Frame\-Usb\-Tmc\-::message\-Data(), mdt\-Frame\-Usb\-Tmc\-::\-Msg\-I\-D(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Abstract\-Port\-::readen\-Frames(), mdt\-Abstract\-Port\-::read\-Frames\-Pool(), mdt\-Port\-Manager\-::restore\-Transaction(), mdt\-Port\-Transaction\-::set\-Data(), mdt\-Port\-Transaction\-::set\-Id(), mdt\-Port\-Manager\-::transaction\-Pending(), mdt\-Port\-Manager\-::unlock\-Port\-Mutex(), and mdt\-Error\-::\-Warning.

\hypertarget{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!is\-Ready@{is\-Ready}}
\index{is\-Ready@{is\-Ready}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{is\-Ready}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Usbtmc\-Port\-Manager\-::is\-Ready (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}


Check if port manager is ready. 

Internally, the current\-State is used to check if port manager is ready. This implementation returns true if current\-State is Ready. 

Reimplemented from \hyperlink{classmdt_port_manager_a6dc2798324521d177fb8f79d4f6c5f0f}{mdt\-Port\-Manager}.



Definition at line 101 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::current\-State(), and mdt\-Port\-Manager\-::\-Ready.



Referenced by send\-Data(), and send\-Read\-Request().

\hypertarget{classmdt_usbtmc_port_manager_a992d1227810186d3c7dc166452e2e3b6}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!scan@{scan}}
\index{scan@{scan}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{scan}]{\setlength{\rightskip}{0pt plus 5cm}Q\-List$<$ {\bf mdt\-Port\-Info} $\ast$ $>$ mdt\-Usbtmc\-Port\-Manager\-::scan (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usbtmc_port_manager_a992d1227810186d3c7dc166452e2e3b6}


Scan for available ports with a U\-S\-B\-T\-M\-C compatible device attached. 

Note that returned list must be freed by user after usage. (for.\-ex. with q\-Delet\-All() and Q\-List\-::clear() ).

\begin{DoxyPrecond}{Precondition}
Manager must be closed 
\end{DoxyPrecond}


Reimplemented from \hyperlink{classmdt_usb_port_manager_a3a2370c3a2d0353a880bf9b777728c3b}{mdt\-Usb\-Port\-Manager}.



Definition at line 72 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::is\-Closed(), mdt\-Device\-Info\-::protocol\-Id(), mdt\-Usb\-Port\-Manager\-::scan(), and mdt\-Device\-Info\-::set\-Display\-Text().



Referenced by mdt\-Device\-Scpi\-::connect\-To\-Device().

\hypertarget{classmdt_usbtmc_port_manager_af6abc4a3693fc386a12f346f57282c11}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Command@{send\-Command}}
\index{send\-Command@{send\-Command}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Command}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Command (
\begin{DoxyParamCaption}
\item[{const Q\-Byte\-Array \&}]{command}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_af6abc4a3693fc386a12f346f57282c11}


Send a command to device. 

At first, this method waits until the ready state is set calling \hyperlink{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{is\-Ready()} , a frame is available in port's write frames pool, and until a transaction is possible (see \hyperlink{classmdt_port_manager_ac04a12f8aa20ba04695083afce45a6cc}{wait\-Transaction\-Possible()} ). This wait will not break event loop, so no G\-U\-I freeze occurs. If port manager is stopped during this wait (unhandled error, stop request), this method returns.

Note that the wait will not break the G\-U\-I's event loop (see mdt\-Port\-Manager\-::wait\-On\-Write\-Ready() for details).


\begin{DoxyParams}{Parameters}
{\em command} & Command to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
b\-Tag on success, or a error $<$ 0 (see mdt\-Usbtmc\-Port\-Manager\-::write\-Data() for details). 
\end{DoxyReturn}


Definition at line 106 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References send\-Data().



Referenced by mdt\-Device\-Scpi\-::send\-Command().

\hypertarget{classmdt_usbtmc_port_manager_a205901666c797055bee1902bd1e1e09c}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Data@{send\-Data}}
\index{send\-Data@{send\-Data}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Data}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Data (
\begin{DoxyParamCaption}
\item[{{\bf mdt\-Port\-Transaction} $\ast$}]{transaction}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usbtmc_port_manager_a205901666c797055bee1902bd1e1e09c}


Send data on port. 

At first, this method waits until the ready state is set calling \hyperlink{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{is\-Ready()} , a frame is available in port's write frames pool, and until a transaction is possible (see \hyperlink{classmdt_port_manager_ac04a12f8aa20ba04695083afce45a6cc}{wait\-Transaction\-Possible()} ). This wait will not break event loop, so no G\-U\-I freeze occurs. If port manager is stopped during this wait (unhandled error, stop request), this method returns.

Then, data contained in transaction will be passed to the \hyperlink{classmdt_port}{mdt\-Port}'s write queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.


\begin{DoxyParams}{Parameters}
{\em transaction} & Transaction used to send data. Following members are used by this method\-:
\begin{DoxyItemize}
\item id \-: transaction will be added to pending transactions with this id, and current\-Transaction\-Id will be set with it.
\item data \-: will be sent to port.
\item is\-Query\-Reply\-Mode \-: if true, the transaction will be keeped in transactions done queue until \hyperlink{classmdt_port_manager_a830ae182d06dd6a52c43a7f45b9240ac}{readen\-Frame()} or \hyperlink{classmdt_port_manager_addd5dcae9644cea42a9871205af41796}{readen\-Frames()} is called. Note\-: it's possible to force keeping all incomming data (wich also owerwrite this flag) by setting the global keep\-Transactions\-Done flag.
\end{DoxyItemize}\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
b\-Tag on success or value $<$ 0 on error. In this implementation, the only possible error is \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85eae50ff4a9393507ad39005ddc7d5be42f}{mdt\-Abstract\-Port\-::\-Write\-Canceled}, witch typically occurs when port manager stops. Note\-: on failure, the transaction is restored to pool. 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} before use of this method. 

transaction must be a valid pointer, and not allready exists in transactions pending or transactions done queue. 
\end{DoxyPrecond}


Reimplemented from \hyperlink{classmdt_port_manager_ad98399edba146af5cf32a9002094385c}{mdt\-Port\-Manager}.



Definition at line 138 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Abstract\-Port\-::add\-Frame\-To\-Write(), mdt\-Frame\-::clear(), mdt\-Frame\-Usb\-Tmc\-::clear\-Sub(), mdt\-Port\-Manager\-::current\-Transaction\-Id(), mdt\-Port\-Transaction\-::data(), mdt\-Frame\-Usb\-Tmc\-::\-D\-E\-V\-\_\-\-D\-E\-P\-\_\-\-M\-S\-G\-\_\-\-O\-U\-T, mdt\-Frame\-Usb\-Tmc\-::encode(), mdt\-Port\-Transaction\-::id(), mdt\-Port\-Manager\-::increment\-Current\-Transaction\-Id(), mdt\-Port\-Manager\-::is\-Closed(), is\-Ready(), mdt\-Port\-Manager\-::lock\-Port\-Mutex(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Port\-Manager\-::restore\-Transaction(), mdt\-Frame\-Usb\-Tmc\-::setb\-Tag(), mdt\-Frame\-Usb\-Tmc\-::set\-E\-O\-M(), mdt\-Port\-Transaction\-::set\-Id(), mdt\-Frame\-Usb\-Tmc\-::set\-Message\-Data(), mdt\-Frame\-Usb\-Tmc\-::set\-Msg\-I\-D(), mdt\-Frame\-::set\-Wait\-An\-Answer(), mdt\-Port\-Manager\-::transactions\-Done\-Contains(), mdt\-Port\-Manager\-::unlock\-Port\-Mutex(), mdt\-Port\-Manager\-::wait\-Transaction\-Possible(), mdt\-Abstract\-Port\-::\-Write\-Canceled, and mdt\-Abstract\-Port\-::write\-Frames\-Pool().



Referenced by mdt\-Device\-Scpi\-::check\-Device\-Error(), mdt\-Device\-U3606\-A\-::get\-Measure\-Configuration(), send\-Command(), send\-Data(), and send\-Query().

\hypertarget{classmdt_usbtmc_port_manager_a6d566c68ddeb7c7ca14b5c70ae784efc}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Data@{send\-Data}}
\index{send\-Data@{send\-Data}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Data}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Data (
\begin{DoxyParamCaption}
\item[{const Q\-Byte\-Array \&}]{data}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_a6d566c68ddeb7c7ca14b5c70ae784efc}


Write data by copy. 

At first, this method waits until the ready state is set calling \hyperlink{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{is\-Ready()} , a frame is available in port's write frames pool, and until a transaction is possible (see \hyperlink{classmdt_port_manager_ac04a12f8aa20ba04695083afce45a6cc}{wait\-Transaction\-Possible()} ). This wait will not break event loop, so no G\-U\-I freeze occurs. If port manager is stopped during this wait (unhandled error, stop request), this method returns.

Then, data will be encoded regarding U\-S\-B\-T\-M\-C standard and passed to the \hyperlink{classmdt_usb_port}{mdt\-Usb\-Port}'s write queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.

This method does not use transaction, because no response will be returned.


\begin{DoxyParams}{Parameters}
{\em data} & Data to write \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
b\-Tag I\-D on success or \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85eae50ff4a9393507ad39005ddc7d5be42f}{mdt\-Abstract\-Port\-::\-Write\-Canceled} ($<$ 0). 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} before use of this method. 
\end{DoxyPrecond}


Definition at line 190 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::get\-New\-Transaction(), mdt\-Port\-Manager\-::pv\-Port, send\-Data(), mdt\-Port\-Transaction\-::set\-Data(), and mdt\-Port\-Transaction\-::set\-Query\-Reply\-Mode().

\hypertarget{classmdt_usbtmc_port_manager_acbbb8539c54034989b2ea6f6071e90bf}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Query@{send\-Query}}
\index{send\-Query@{send\-Query}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Query}]{\setlength{\rightskip}{0pt plus 5cm}Q\-Byte\-Array mdt\-Usbtmc\-Port\-Manager\-::send\-Query (
\begin{DoxyParamCaption}
\item[{const Q\-Byte\-Array \&}]{query}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_acbbb8539c54034989b2ea6f6071e90bf}


Send a query to device. 

Will wait until it's possible to write. See \hyperlink{classmdt_usbtmc_port_manager_a205901666c797055bee1902bd1e1e09c}{send\-Data()} and \hyperlink{classmdt_usbtmc_port_manager_a2920bdd6b189f198f132de9e5555a78b}{send\-Read\-Request()} for details (used internally).


\begin{DoxyParams}{Parameters}
{\em query} & Query to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Result as string (empty string on error) Note that \hyperlink{classmdt_frame_codec_scpi}{mdt\-Frame\-Codec\-Scpi} can be helpful to decode returned result. 
\end{DoxyReturn}


Definition at line 111 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::get\-New\-Transaction(), mdt\-Frame\-Codec\-Scpi\-::\-Q\-T\-\_\-\-U\-N\-K\-N\-O\-W, mdt\-Port\-Manager\-::readen\-Frame(), send\-Data(), send\-Read\-Request(), mdt\-Port\-Transaction\-::set\-Query\-Reply\-Mode(), mdt\-Port\-Transaction\-::set\-Type(), and mdt\-Port\-Manager\-::wait\-Transaction\-Done().



Referenced by mdt\-Device\-Scpi\-::send\-Query().

\hypertarget{classmdt_usbtmc_port_manager_a2920bdd6b189f198f132de9e5555a78b}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Read\-Request@{send\-Read\-Request}}
\index{send\-Read\-Request@{send\-Read\-Request}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Read\-Request}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Read\-Request (
\begin{DoxyParamCaption}
\item[{{\bf mdt\-Port\-Transaction} $\ast$}]{transaction}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_a2920bdd6b189f198f132de9e5555a78b}


Send a read request to device. 

U\-S\-B\-T\-M\-C standard need that a read request is sent to device before we can read any data.

At first, this method waits until the ready state is set calling \hyperlink{classmdt_usbtmc_port_manager_a0b90ceb0bbf424222ec878a355d206d7}{is\-Ready()} , and a frame is available in port's write frames pool. This wait will not break event loop, so no G\-U\-I freeze occurs. If port manager is stopped during this wait (unhandled error, stop request), this method returns.


\begin{DoxyParams}{Parameters}
{\em transaction} & A pointer to a valid transaction, with query\-Reply\-Mode set. (id will be set internally). \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
b\-Tag I\-D on success or \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85eae50ff4a9393507ad39005ddc7d5be42f}{mdt\-Abstract\-Port\-::\-Write\-Canceled} ($<$ 0). On failure, the transaction is restored to pool. 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
port must be set 

transaction must be a valid pointer 
\end{DoxyPrecond}


Definition at line 204 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Abstract\-Port\-::add\-Frame\-To\-Write(), mdt\-Port\-Manager\-::add\-Transaction\-Pending(), mdt\-Frame\-::clear(), mdt\-Frame\-Usb\-Tmc\-::clear\-Sub(), mdt\-Port\-Manager\-::config(), mdt\-Port\-Manager\-::current\-Transaction\-Id(), mdt\-Frame\-Usb\-Tmc\-::\-D\-E\-V\-\_\-\-D\-E\-P\-\_\-\-M\-S\-G\-\_\-\-I\-N, mdt\-Frame\-Usb\-Tmc\-::encode(), mdt\-Port\-Manager\-::increment\-Current\-Transaction\-Id(), mdt\-Port\-Manager\-::is\-Closed(), is\-Ready(), mdt\-Port\-Manager\-::lock\-Port\-Mutex(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Port\-Manager\-::restore\-Transaction(), mdt\-Frame\-Usb\-Tmc\-::setb\-Tag(), mdt\-Port\-Transaction\-::set\-Id(), mdt\-Frame\-Usb\-Tmc\-::set\-Msg\-I\-D(), mdt\-Frame\-Usb\-Tmc\-::set\-Transfer\-Size(), mdt\-Frame\-::set\-Wait\-An\-Answer(), mdt\-Port\-Manager\-::unlock\-Port\-Mutex(), mdt\-Port\-Manager\-::wait\-Transaction\-Possible(), mdt\-Abstract\-Port\-::\-Write\-Canceled, and mdt\-Abstract\-Port\-::write\-Frames\-Pool().



Referenced by mdt\-Device\-Scpi\-::check\-Device\-Error(), mdt\-Device\-U3606\-A\-::get\-Measure\-Configuration(), send\-Query(), and send\-Read\-Request().

\hypertarget{classmdt_usbtmc_port_manager_ab1604a1c8f2e9192714d039dbf9a5158}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Read\-Request@{send\-Read\-Request}}
\index{send\-Read\-Request@{send\-Read\-Request}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Read\-Request}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Read\-Request (
\begin{DoxyParamCaption}
\item[{bool}]{enqueue\-Response}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_ab1604a1c8f2e9192714d039dbf9a5158}


Send a read request to device. 

U\-S\-B\-T\-M\-C standard need that a read request is sent to device before we can read any data.


\begin{DoxyParams}{Parameters}
{\em enqueue\-Response} & When data comes in,\\
\hline
\end{DoxyParams}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000051}{Todo}]Sig\-Name is emited. In blocking mode, data must (additionally) be enqueued until there are readen. So, for blocking mode (\char`\"{}script\char`\"{}), set this parameter true. \begin{DoxyReturn}{Returns}
b\-Tag I\-D on success or value $<$ 0 if write queue is full. 
\end{DoxyReturn}
\end{DoxyRefDesc}


Definition at line 257 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::get\-New\-Transaction(), send\-Read\-Request(), and mdt\-Port\-Transaction\-::set\-Query\-Reply\-Mode().

\hypertarget{classmdt_usbtmc_port_manager_a7bcc280bd4a26ed523832550b1e61553}{\index{mdt\-Usbtmc\-Port\-Manager@{mdt\-Usbtmc\-Port\-Manager}!send\-Read\-Status\-Byte\-Request@{send\-Read\-Status\-Byte\-Request}}
\index{send\-Read\-Status\-Byte\-Request@{send\-Read\-Status\-Byte\-Request}!mdtUsbtmcPortManager@{mdt\-Usbtmc\-Port\-Manager}}
\subsubsection[{send\-Read\-Status\-Byte\-Request}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usbtmc\-Port\-Manager\-::send\-Read\-Status\-Byte\-Request (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_usbtmc_port_manager_a7bcc280bd4a26ed523832550b1e61553}


Send a R\-E\-A\-D\-\_\-\-S\-T\-A\-T\-U\-S\-\_\-\-B\-Y\-T\-E request thru the control endpoint. 

\begin{DoxyReturn}{Returns}
b\-Tag on success or Write\-Queue\-Empty on error.
\end{DoxyReturn}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000049}{Todo}]finish ! \end{DoxyRefDesc}


Definition at line 269 of file mdt\-Usbtmc\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::current\-Transaction\-Id(), mdt\-Frame\-Usb\-Control\-::encode(), mdt\-Port\-Manager\-::increment\-Current\-Transaction\-Id(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Frame\-Usb\-Control\-::\-R\-R\-\_\-\-I\-N\-T\-E\-R\-F\-A\-C\-E, mdt\-Frame\-Usb\-Control\-::\-R\-T\-\_\-\-C\-L\-A\-S\-S, mdt\-Usb\-Port\-Manager\-::send\-Control\-Request(), mdt\-Frame\-Usb\-Control\-::setb\-Request(), mdt\-Frame\-Usb\-Control\-::set\-Direction\-Device\-To\-Host(), mdt\-Frame\-Usb\-Control\-::set\-Request\-Recipient(), mdt\-Frame\-Usb\-Control\-::set\-Request\-Type(), mdt\-Frame\-Usb\-Control\-::setw\-Length(), and mdt\-Frame\-Usb\-Control\-::setw\-Value().



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/mdtport/\hyperlink{mdt_usbtmc_port_manager_8h}{mdt\-Usbtmc\-Port\-Manager.\-h}\item 
src/mdtport/\hyperlink{mdt_usbtmc_port_manager_8cpp}{mdt\-Usbtmc\-Port\-Manager.\-cpp}\end{DoxyCompactItemize}
