\hypertarget{classmdt_frame_codec_modbus}{
\section{mdtFrameCodecModbus Class Reference}
\label{classmdt_frame_codec_modbus}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}}
}


Encode and decode MODBUS PDU NOTE: stockage des adresses durant Q/R ?  




{\ttfamily \#include $<$mdtFrameCodecModbus.h$>$}



Inheritance diagram for mdtFrameCodecModbus:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=204pt]{classmdt_frame_codec_modbus__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdtFrameCodecModbus:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=204pt]{classmdt_frame_codec_modbus__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Types}
\begin{DoxyCompactItemize}
\item 
enum \hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7}{modbus\_\-error\_\-code\_\-t} \{ \par
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab1a954c9125bbf1f79c69d480faec4b}{UNKNOW\_\-ERROR}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab0437de7413a72446c491f518249a0a}{ILLEGAL\_\-FUNCTION} =  1, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a1eeaee68c0cb3fc2c9dd26e9540c4fc3}{ILLEGAL\_\-DATA\_\-ADDRESS}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a99ff0045d822da03e709508ce1acf85b}{ILLEGAL\_\-DATA\_\-VALUE}, 
\par
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aa458eaabf779b5936891a69d64eb05ac}{SLAVE\_\-DEVICE\_\-FAILURE}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7abcc3d663faf228569aea757d3c26611d}{ACKNOWLEDGE}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7afc6561ef2b014e3dd0e6ae2dd1d09201}{SLAVE\_\-DEVICE\_\-BUSY}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7ade44de70235367650161630c7dde3c4b}{RESERVE\_\-ERROR\_\-7}, 
\par
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a82a7c52e774764f6b76d286bde96accf}{MEMORY\_\-PARITY\_\-ERROR}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a956e96d465ca9152e77d09ee022b1a5f}{RESERVE\_\-ERROR\_\-9}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a8a4a5e81091eb2c57fd57dee450a2770}{GATEWAY\_\-PATH\_\-UNAVAILABLE}, 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a9ca48eb9d1ab05850c36170e7dac0b99}{GATEWAY\_\-TARGET\_\-RESPONSE}
 \}
\begin{DoxyCompactList}\small\item\em MODBUS response error code. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
QByteArray \hyperlink{classmdt_frame_codec_modbus_adf0a4d583aeff7b818dda94514c594f0}{encodeReadCoils} (quint16 startAddress, quint16 n)
\begin{DoxyCompactList}\small\item\em Encode a PDU according the ReadCoils function (0x01) \end{DoxyCompactList}\item 
QByteArray \hyperlink{classmdt_frame_codec_modbus_a123f63422bb34fcb10ac653c0e89e79e}{encodeWriteSingleCoil} (quint16 address, bool state)
\begin{DoxyCompactList}\small\item\em Encode a PDU according the WriteSingleCoil function (0x05) \end{DoxyCompactList}\item 
int \hyperlink{classmdt_frame_codec_modbus_a426f465363a49d70890a462b40677787}{decode} (const QByteArray \&pdu)
\begin{DoxyCompactList}\small\item\em Decode a MODBUS PDU. \end{DoxyCompactList}\item 
\hyperlink{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7}{modbus\_\-error\_\-code\_\-t} \hyperlink{classmdt_frame_codec_modbus_a21f3102e12f1a1d9c4145c1ce1f8e6b6}{lastModbusError} ()
\begin{DoxyCompactList}\small\item\em Get the last MODBUS error code returned. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
Encode and decode MODBUS PDU NOTE: stockage des adresses durant Q/R ? 

This class works only on MODBUS PDU. To transmit MODBUS/TCP frame, the resulting PDU can be sent using \hyperlink{classmdt_frame_modbus_tcp}{mdtFrameModbusTcp} class, or received PDU decoded here.

References:
\begin{DoxyItemize}
\item MODBUS Application Protocol Specification V1.1b
\item \href{http://www.Modbus-IDA.org}{\tt http://www.Modbus-\/IDA.org}
\end{DoxyItemize}

\begin{DoxySeeAlso}{See also}
\hyperlink{classmdt_frame_codec}{mdtFrameCodec} 

\hyperlink{classmdt_frame_modbus_tcp}{mdtFrameModbusTcp} 
\end{DoxySeeAlso}


\subsection{Member Enumeration Documentation}
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7}{
\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!modbus\_\-error\_\-code\_\-t@{modbus\_\-error\_\-code\_\-t}}
\index{modbus\_\-error\_\-code\_\-t@{modbus\_\-error\_\-code\_\-t}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}
\subsubsection[{modbus\_\-error\_\-code\_\-t}]{\setlength{\rightskip}{0pt plus 5cm}enum {\bf mdtFrameCodecModbus::modbus\_\-error\_\-code\_\-t}}}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7}


MODBUS response error code. 

\begin{Desc}
\item[Enumerator: ]\par
\begin{description}
\index{UNKNOW\_\-ERROR@{UNKNOW\_\-ERROR}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!UNKNOW\_\-ERROR@{UNKNOW\_\-ERROR}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab1a954c9125bbf1f79c69d480faec4b}{
UNKNOW\_\-ERROR}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab1a954c9125bbf1f79c69d480faec4b}
}]Error is unknow from codec \index{ILLEGAL\_\-FUNCTION@{ILLEGAL\_\-FUNCTION}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!ILLEGAL\_\-FUNCTION@{ILLEGAL\_\-FUNCTION}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab0437de7413a72446c491f518249a0a}{
ILLEGAL\_\-FUNCTION}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aab0437de7413a72446c491f518249a0a}
}]Code 0x01: Function is not allowed for the server \index{ILLEGAL\_\-DATA\_\-ADDRESS@{ILLEGAL\_\-DATA\_\-ADDRESS}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!ILLEGAL\_\-DATA\_\-ADDRESS@{ILLEGAL\_\-DATA\_\-ADDRESS}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a1eeaee68c0cb3fc2c9dd26e9540c4fc3}{
ILLEGAL\_\-DATA\_\-ADDRESS}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a1eeaee68c0cb3fc2c9dd26e9540c4fc3}
}]Code 0x02: Request address is not in range of the server \index{ILLEGAL\_\-DATA\_\-VALUE@{ILLEGAL\_\-DATA\_\-VALUE}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!ILLEGAL\_\-DATA\_\-VALUE@{ILLEGAL\_\-DATA\_\-VALUE}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a99ff0045d822da03e709508ce1acf85b}{
ILLEGAL\_\-DATA\_\-VALUE}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a99ff0045d822da03e709508ce1acf85b}
}]Code 0x03: Request value is not in allowed from server \index{SLAVE\_\-DEVICE\_\-FAILURE@{SLAVE\_\-DEVICE\_\-FAILURE}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!SLAVE\_\-DEVICE\_\-FAILURE@{SLAVE\_\-DEVICE\_\-FAILURE}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aa458eaabf779b5936891a69d64eb05ac}{
SLAVE\_\-DEVICE\_\-FAILURE}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7aa458eaabf779b5936891a69d64eb05ac}
}]Code 0x04: Unrecoverable failue on server \index{ACKNOWLEDGE@{ACKNOWLEDGE}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!ACKNOWLEDGE@{ACKNOWLEDGE}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7abcc3d663faf228569aea757d3c26611d}{
ACKNOWLEDGE}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7abcc3d663faf228569aea757d3c26611d}
}]Code 0x05: Request accepted, but mor time is needed (server side) for response \index{SLAVE\_\-DEVICE\_\-BUSY@{SLAVE\_\-DEVICE\_\-BUSY}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!SLAVE\_\-DEVICE\_\-BUSY@{SLAVE\_\-DEVICE\_\-BUSY}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7afc6561ef2b014e3dd0e6ae2dd1d09201}{
SLAVE\_\-DEVICE\_\-BUSY}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7afc6561ef2b014e3dd0e6ae2dd1d09201}
}]Code 0x06: Server busy, client should try to resend the query later \index{RESERVE\_\-ERROR\_\-7@{RESERVE\_\-ERROR\_\-7}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!RESERVE\_\-ERROR\_\-7@{RESERVE\_\-ERROR\_\-7}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7ade44de70235367650161630c7dde3c4b}{
RESERVE\_\-ERROR\_\-7}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7ade44de70235367650161630c7dde3c4b}
}]Not used in current specification \index{MEMORY\_\-PARITY\_\-ERROR@{MEMORY\_\-PARITY\_\-ERROR}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!MEMORY\_\-PARITY\_\-ERROR@{MEMORY\_\-PARITY\_\-ERROR}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a82a7c52e774764f6b76d286bde96accf}{
MEMORY\_\-PARITY\_\-ERROR}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a82a7c52e774764f6b76d286bde96accf}
}]Code 0x08: Parity error related to code function 20 and 21 \index{RESERVE\_\-ERROR\_\-9@{RESERVE\_\-ERROR\_\-9}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!RESERVE\_\-ERROR\_\-9@{RESERVE\_\-ERROR\_\-9}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a956e96d465ca9152e77d09ee022b1a5f}{
RESERVE\_\-ERROR\_\-9}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a956e96d465ca9152e77d09ee022b1a5f}
}]Not used in current specification \index{GATEWAY\_\-PATH\_\-UNAVAILABLE@{GATEWAY\_\-PATH\_\-UNAVAILABLE}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!GATEWAY\_\-PATH\_\-UNAVAILABLE@{GATEWAY\_\-PATH\_\-UNAVAILABLE}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a8a4a5e81091eb2c57fd57dee450a2770}{
GATEWAY\_\-PATH\_\-UNAVAILABLE}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a8a4a5e81091eb2c57fd57dee450a2770}
}]Code 0x0A: Error from a gateway (misconfigured or overloaded) \index{GATEWAY\_\-TARGET\_\-RESPONSE@{GATEWAY\_\-TARGET\_\-RESPONSE}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!GATEWAY\_\-TARGET\_\-RESPONSE@{GATEWAY\_\-TARGET\_\-RESPONSE}}\item[{\em 
\hypertarget{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a9ca48eb9d1ab05850c36170e7dac0b99}{
GATEWAY\_\-TARGET\_\-RESPONSE}
\label{classmdt_frame_codec_modbus_a31d8291be7f8636d5d295ce3066d7ac7a9ca48eb9d1ab05850c36170e7dac0b99}
}]Code 0x0B: Error from a gateway: target device not present on network \end{description}
\end{Desc}



\subsection{Member Function Documentation}
\hypertarget{classmdt_frame_codec_modbus_a426f465363a49d70890a462b40677787}{
\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!decode@{decode}}
\index{decode@{decode}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}
\subsubsection[{decode}]{\setlength{\rightskip}{0pt plus 5cm}int mdtFrameCodecModbus::decode (
\begin{DoxyParamCaption}
\item[{const QByteArray \&}]{pdu}
\end{DoxyParamCaption}
)}}
\label{classmdt_frame_codec_modbus_a426f465363a49d70890a462b40677787}


Decode a MODBUS PDU. 

This should reconize the function code in PDU, and call the appropriate decode methode (internall). Once decode is done, the values are available with \hyperlink{classmdt_frame_codec_a599a46e2d7cb5f80bd80e303236ead73}{mdtFrameCodec::values()}. To know what was decoded, the function code is returned.\par
 The values are stored in a QList$<$QVariant$>$ , with format depending of the function code:
\begin{DoxyItemize}
\item For a ReadCoils response, values will be bool, sorted by ascending addresses.
\end{DoxyItemize}

If PDU contains a error code, the list of values will be empty, and this error code will be returned.\par
 If a MODBUS error code is decoded, this error code is returned as in frame (for. ex: 0x81 for a ReadCoils error) To know whitch MODBUS error was returned, use \hyperlink{classmdt_frame_codec_modbus_a21f3102e12f1a1d9c4145c1ce1f8e6b6}{lastModbusError()}


\begin{DoxyParams}{Parameters}
{\em pdu} & The MODBUS PDU to decode \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Decoded function code, MODBUS error code or value $<$ 0 on other error. 
\end{DoxyReturn}


NOTE:\begin{Desc}
\item[\hyperlink{todo__todo000036}{Todo}]Base 16 ?? \end{Desc}


\hypertarget{classmdt_frame_codec_modbus_adf0a4d583aeff7b818dda94514c594f0}{
\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!encodeReadCoils@{encodeReadCoils}}
\index{encodeReadCoils@{encodeReadCoils}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}
\subsubsection[{encodeReadCoils}]{\setlength{\rightskip}{0pt plus 5cm}QByteArray mdtFrameCodecModbus::encodeReadCoils (
\begin{DoxyParamCaption}
\item[{quint16}]{startAddress, }
\item[{quint16}]{n}
\end{DoxyParamCaption}
)}}
\label{classmdt_frame_codec_modbus_adf0a4d583aeff7b818dda94514c594f0}


Encode a PDU according the ReadCoils function (0x01) 

Please take a look at MODBUS specifications for more details. \begin{DoxyReturn}{Returns}
A QByteArray containing the PDU, or a empty QByteArray on error. 
\end{DoxyReturn}
\hypertarget{classmdt_frame_codec_modbus_a123f63422bb34fcb10ac653c0e89e79e}{
\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!encodeWriteSingleCoil@{encodeWriteSingleCoil}}
\index{encodeWriteSingleCoil@{encodeWriteSingleCoil}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}
\subsubsection[{encodeWriteSingleCoil}]{\setlength{\rightskip}{0pt plus 5cm}QByteArray mdtFrameCodecModbus::encodeWriteSingleCoil (
\begin{DoxyParamCaption}
\item[{quint16}]{address, }
\item[{bool}]{state}
\end{DoxyParamCaption}
)}}
\label{classmdt_frame_codec_modbus_a123f63422bb34fcb10ac653c0e89e79e}


Encode a PDU according the WriteSingleCoil function (0x05) 

Please take a look at MODBUS specifications for more details. \begin{DoxyReturn}{Returns}
A QByteArray containing the PDU, or a empty QByteArray on error. 
\end{DoxyReturn}
\hypertarget{classmdt_frame_codec_modbus_a21f3102e12f1a1d9c4145c1ce1f8e6b6}{
\index{mdtFrameCodecModbus@{mdtFrameCodecModbus}!lastModbusError@{lastModbusError}}
\index{lastModbusError@{lastModbusError}!mdtFrameCodecModbus@{mdtFrameCodecModbus}}
\subsubsection[{lastModbusError}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtFrameCodecModbus::modbus\_\-error\_\-code\_\-t} mdtFrameCodecModbus::lastModbusError (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{classmdt_frame_codec_modbus_a21f3102e12f1a1d9c4145c1ce1f8e6b6}


Get the last MODBUS error code returned. 

Returns the error code according to the specification, part function/error codes (same value). \begin{DoxySeeAlso}{See also}
\hyperlink{classmdt_frame_codec_modbus_a426f465363a49d70890a462b40677787}{decode()} 
\end{DoxySeeAlso}


The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
src/mdtutils/mdtFrameCodecModbus.h\item 
src/mdtutils/mdtFrameCodecModbus.cpp\end{DoxyCompactItemize}
