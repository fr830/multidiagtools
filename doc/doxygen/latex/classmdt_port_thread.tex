\hypertarget{classmdt_port_thread}{
\section{mdtPortThread Class Reference}
\label{classmdt_port_thread}\index{mdtPortThread@{mdtPortThread}}
}


Inheritance diagram for mdtPortThread:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=400pt]{classmdt_port_thread__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdtPortThread:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=168pt]{classmdt_port_thread__coll__graph}
\end{center}
\end{figure}
\subsection*{Signals}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_port_thread_abb7234a12814f5c7c98bd6c1c2ccb776}{readProcessBegin} ()
\begin{DoxyCompactList}\small\item\em Emitted when a read process begins. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_thread_aa01aac7e1a26deb823be40e6cb01b255}{writeProcessBegin} ()
\begin{DoxyCompactList}\small\item\em Emitted when a write process begins. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{newFrameReaden} ()
\begin{DoxyCompactList}\small\item\em Emited when a new frame is available. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{errorOccured} (int error)
\begin{DoxyCompactList}\small\item\em Emitted on error. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classmdt_port_thread_aa20869c68d7a016f9e547464f0d8b71e}{
{\bfseries mdtPortThread} (QObject $\ast$parent=0)}
\label{classmdt_port_thread_aa20869c68d7a016f9e547464f0d8b71e}

\item 
void \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort} (\hyperlink{classmdt_abstract_port}{mdtAbstractPort} $\ast$port)
\begin{DoxyCompactList}\small\item\em Set the port instance. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_thread_a29b434534a5564efbd9dfe570a61b143}{detachPort} (bool releaseMemory)
\begin{DoxyCompactList}\small\item\em Detach the port from thread. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_port_thread_a9c45f260b8d58b7475151df79b3d8510}{start} ()
\begin{DoxyCompactList}\small\item\em Start the thread. \end{DoxyCompactList}\item 
virtual void \hyperlink{classmdt_port_thread_a5746ea96689ed80179751ad1353f0b39}{stop} ()
\begin{DoxyCompactList}\small\item\em Stop the running thread. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_port_thread_ae1becf17263dd9fbf5dfcc6c51eddd72}{isRunning} () const 
\begin{DoxyCompactList}\small\item\em Returns true if the thread is running. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_port_thread_a55d7ef615447823bf9878492a2c88fd4}{isFinished} () const 
\begin{DoxyCompactList}\small\item\em Returns false if the thread is running. \end{DoxyCompactList}\item 
virtual bool \hyperlink{classmdt_port_thread_acdb3d96287c571cc08ef39860dc324b1}{isReader} () const 
\begin{DoxyCompactList}\small\item\em Returns true if this thread reads data and send the \hyperlink{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{newFrameReaden()} signal. \end{DoxyCompactList}\item 
virtual bool \hyperlink{classmdt_port_thread_a0122a12262052cf3643241a3eaa31c58}{isWriter} () const 
\begin{DoxyCompactList}\small\item\em Returns true if this thread writes date. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} \hyperlink{classmdt_port_thread_ab87390447ace7e893661ae492b9d5994}{handleCommonErrors} (\hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} portError)
\begin{DoxyCompactList}\small\item\em Handle common errors. \end{DoxyCompactList}\item 
\hyperlink{classmdt_frame}{mdtFrame} $\ast$ \hyperlink{classmdt_port_thread_a611211e56620ec9c699019452716e4fc}{getNewFrameRead} ()
\begin{DoxyCompactList}\small\item\em Get a new frame for reading data from port. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_port_thread_a8756fe2a26bf267376b4003a2896ff48}{readFromPort} (\hyperlink{classmdt_frame}{mdtFrame} $\ast$$\ast$frame, bool emitNewFrameReaden=true)
\begin{DoxyCompactList}\small\item\em Read data from port. \end{DoxyCompactList}\item 
\hyperlink{classmdt_frame}{mdtFrame} $\ast$ \hyperlink{classmdt_port_thread_acba4fce38a633da68ec23fe191ba6105}{getNewFrameWrite} ()
\begin{DoxyCompactList}\small\item\em Get a new frame for writing data to port. \end{DoxyCompactList}\item 
qint64 \hyperlink{classmdt_port_thread_aa18ebea6a8791d228ab9575d1c68067c}{writeDataToPort} (\hyperlink{classmdt_frame}{mdtFrame} $\ast$frame, int maxSize=-\/1)
\begin{DoxyCompactList}\small\item\em Write data to port. \end{DoxyCompactList}\item 
\hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} \hyperlink{classmdt_port_thread_a2658d7f1a04ef10eb09d575d8d7eda43}{writeToPort} (\hyperlink{classmdt_frame}{mdtFrame} $\ast$frame, bool bytePerByteWrite, int interByteTime, int maxWriteTry=10)
\begin{DoxyCompactList}\small\item\em Write a complete frame to port. \end{DoxyCompactList}\item 
\hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} \hyperlink{classmdt_port_thread_abee1d2f9b67ca37cfd13e108ca978b36}{reconnect} (bool notify=true)
\begin{DoxyCompactList}\small\item\em Try to reconnect to device/peer. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_port_thread_a37883c167ec85ff7a4996ffea5288ffe}{notifyError} (int error, bool renotifySameError=false)
\begin{DoxyCompactList}\small\item\em Emit the \hyperlink{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{errorOccured()} signal if new error is different from current. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Static Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
static void \hyperlink{classmdt_port_thread_a01d2362e0dfcece4cba242cb586d8d1c}{sigactionHandle} (int signum)
\end{DoxyCompactItemize}
\subsection*{Protected Attributes}
\begin{DoxyCompactItemize}
\item 
\hypertarget{classmdt_port_thread_a59735ef01b761361b1055a0356be525a}{
volatile bool {\bfseries pvRunning}}
\label{classmdt_port_thread_a59735ef01b761361b1055a0356be525a}

\item 
\hypertarget{classmdt_port_thread_af5c4bed0c9fb012f220fba013d0f69b8}{
\hyperlink{classmdt_abstract_port}{mdtAbstractPort} $\ast$ {\bfseries pvPort}}
\label{classmdt_port_thread_af5c4bed0c9fb012f220fba013d0f69b8}

\item 
\hypertarget{classmdt_port_thread_a7154af7d387eecaea113ddb5900ff23c}{
pthread\_\-t {\bfseries pvNativePthreadObject}}
\label{classmdt_port_thread_a7154af7d387eecaea113ddb5900ff23c}

\item 
\hypertarget{classmdt_port_thread_ae22f83fd56b06cdaa9b77abafe85a6b4}{
struct sigaction {\bfseries pvSigaction}}
\label{classmdt_port_thread_ae22f83fd56b06cdaa9b77abafe85a6b4}

\end{DoxyCompactItemize}


\subsection{Detailed Description}


Definition at line 36 of file mdtPortThread.h.



\subsection{Member Function Documentation}
\hypertarget{classmdt_port_thread_a29b434534a5564efbd9dfe570a61b143}{
\index{mdtPortThread@{mdtPortThread}!detachPort@{detachPort}}
\index{detachPort@{detachPort}!mdtPortThread@{mdtPortThread}}
\subsubsection[{detachPort}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::detachPort (
\begin{DoxyParamCaption}
\item[{bool}]{releaseMemory}
\end{DoxyParamCaption}
)}}
\label{classmdt_port_thread_a29b434534a5564efbd9dfe570a61b143}


Detach the port from thread. 


\begin{DoxyParams}{Parameters}
{\em releaseMemory} & If true, the port object that was set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} will be deleted. \\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}
The thread must not running 
\end{DoxyPrecond}


Definition at line 64 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{
\index{mdtPortThread@{mdtPortThread}!errorOccured@{errorOccured}}
\index{errorOccured@{errorOccured}!mdtPortThread@{mdtPortThread}}
\subsubsection[{errorOccured}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::errorOccured (
\begin{DoxyParamCaption}
\item[{int}]{error}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}signal\mbox{]}}}}
\label{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}


Emitted on error. 

\begin{Desc}
\item[\hyperlink{todo__todo000031}{Todo}]Adapt threads + port managers\end{Desc}


When a error occurs, this signal is emited.

The error is one of the \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t}.

\hyperlink{classmdt_port_manager}{mdtPortManager} uses this signal. \hypertarget{classmdt_port_thread_a611211e56620ec9c699019452716e4fc}{
\index{mdtPortThread@{mdtPortThread}!getNewFrameRead@{getNewFrameRead}}
\index{getNewFrameRead@{getNewFrameRead}!mdtPortThread@{mdtPortThread}}
\subsubsection[{getNewFrameRead}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtFrame} $\ast$ mdtPortThread::getNewFrameRead (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_a611211e56620ec9c699019452716e4fc}


Get a new frame for reading data from port. 

This is a helper method for subclass to get a new frame in port's read frames pool.

It can hapen that the read frames pool is empty. In this case, a error will be generated in the \hyperlink{classmdt_error}{mdtError} log system, the signal \hyperlink{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{errorOccured()} will be emited with MDT\_\-PORT\_\-QUEUE\_\-EMPTY\_\-ERROR value, and method will go sleep until a new frame is available in pool.

\begin{Desc}
\item[\hyperlink{todo__todo000032}{Todo}]Currently implemented in polling, should be done with a wait condition.\end{Desc}


Note about port mutex handling:\par
 The port mutext must be locked before calling this method. Internally, it will be unlocked during wait, and will be locked again. So, the port mutex is allways locked when this method returns.

\begin{DoxyReturn}{Returns}
A pointer to a new frame. This frame is cleared (with \hyperlink{classmdt_frame_acdf8a921a3f36ca91af88b55b90febdc}{mdtFrame::clear()} ). If the runnig flag becomes false, a Null pointer is returned, and thread should stop.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 
\end{DoxyPrecond}


Definition at line 212 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_acba4fce38a633da68ec23fe191ba6105}{
\index{mdtPortThread@{mdtPortThread}!getNewFrameWrite@{getNewFrameWrite}}
\index{getNewFrameWrite@{getNewFrameWrite}!mdtPortThread@{mdtPortThread}}
\subsubsection[{getNewFrameWrite}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtFrame} $\ast$ mdtPortThread::getNewFrameWrite (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_acba4fce38a633da68ec23fe191ba6105}


Get a new frame for writing data to port. 

This is a helper method for subclass to get a new frame in port's write frames.

If no frame is available for write, this method will block the caller thread until one is avaliable.

Note about port mutex handling:\par
 The port mutext must be locked before calling this method. Internally, it will be unlocked during wait, and will be locked again. So, the port mutex is allways locked when this method returns.

\begin{DoxyReturn}{Returns}
A pointer to a new frame, or Null on stop request.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 
\end{DoxyPrecond}
\begin{DoxySeeAlso}{See also}
\hyperlink{classmdt_abstract_port}{mdtAbstractPort} 
\end{DoxySeeAlso}


Definition at line 318 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_ab87390447ace7e893661ae492b9d5994}{
\index{mdtPortThread@{mdtPortThread}!handleCommonErrors@{handleCommonErrors}}
\index{handleCommonErrors@{handleCommonErrors}!mdtPortThread@{mdtPortThread}}
\subsubsection[{handleCommonErrors}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtAbstractPort::error\_\-t} mdtPortThread::handleCommonErrors (
\begin{DoxyParamCaption}
\item[{{\bf mdtAbstractPort::error\_\-t}}]{portError}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_ab87390447ace7e893661ae492b9d5994}


Handle common errors. 

Common errors are:
\begin{DoxyItemize}
\item \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85ea8b70726d03f75a691ac4ad65722a5f3c}{mdtAbstractPort::Disconnected} : will try to reconnect
\end{DoxyItemize}


\begin{DoxyParams}{Parameters}
{\em portError} & Error to handle \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
NoError if error could be handled, UnhadledError if a known error fails to be solved, given portError else. 
\end{DoxyReturn}


Definition at line 198 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a55d7ef615447823bf9878492a2c88fd4}{
\index{mdtPortThread@{mdtPortThread}!isFinished@{isFinished}}
\index{isFinished@{isFinished}!mdtPortThread@{mdtPortThread}}
\subsubsection[{isFinished}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtPortThread::isFinished (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}
\label{classmdt_port_thread_a55d7ef615447823bf9878492a2c88fd4}


Returns false if the thread is running. 

\begin{DoxySeeAlso}{See also}
\hyperlink{classmdt_port_thread_ae1becf17263dd9fbf5dfcc6c51eddd72}{isRunning()} 
\end{DoxySeeAlso}


Q\_\-ASSERT(pvPort != 0); 



Definition at line 171 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_acdb3d96287c571cc08ef39860dc324b1}{
\index{mdtPortThread@{mdtPortThread}!isReader@{isReader}}
\index{isReader@{isReader}!mdtPortThread@{mdtPortThread}}
\subsubsection[{isReader}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtPortThread::isReader (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classmdt_port_thread_acdb3d96287c571cc08ef39860dc324b1}


Returns true if this thread reads data and send the \hyperlink{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{newFrameReaden()} signal. 

\hyperlink{classmdt_port_manager}{mdtPortManager} can handle many threads. It needs to know wich one will send the \hyperlink{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{newFrameReaden()} signal, so it can connect it to his slot.

Default implementation returns allways false.

This method should be implemented in reader subclass. 

Reimplemented in \hyperlink{classmdt_port_read_thread_a0138d613b61056c9f8373331de2d9a84}{mdtPortReadThread}, \hyperlink{classmdt_port_write_thread_ac37bb988773f624def51e841998a2f1e}{mdtPortWriteThread}, \hyperlink{classmdt_tcp_socket_thread_a3224f12c8ff8d695975030f3f6215010}{mdtTcpSocketThread}, \hyperlink{classmdt_usb_port_thread_aed82b57c84745f1e2391750697db1022}{mdtUsbPortThread}, \hyperlink{classmdt_usbtmc_port_thread_a27c115427b49d5ae988c9f9c9a5e402a}{mdtUsbtmcPortThread}, and \hyperlink{classmdt_serial_port_ctl_thread_ab87413cedc8d0540eac553e55a3f6407}{mdtSerialPortCtlThread}.



Definition at line 188 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_ae1becf17263dd9fbf5dfcc6c51eddd72}{
\index{mdtPortThread@{mdtPortThread}!isRunning@{isRunning}}
\index{isRunning@{isRunning}!mdtPortThread@{mdtPortThread}}
\subsubsection[{isRunning}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtPortThread::isRunning (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const}}
\label{classmdt_port_thread_ae1becf17263dd9fbf5dfcc6c51eddd72}


Returns true if the thread is running. 

This function overloads the QThread::isRunning() function. Note for subclass: when the thread is started and ready, the private member pvRunning must be set to true. 

Q\_\-ASSERT(pvPort != 0); 



Definition at line 152 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a0122a12262052cf3643241a3eaa31c58}{
\index{mdtPortThread@{mdtPortThread}!isWriter@{isWriter}}
\index{isWriter@{isWriter}!mdtPortThread@{mdtPortThread}}
\subsubsection[{isWriter}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtPortThread::isWriter (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
) const\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classmdt_port_thread_a0122a12262052cf3643241a3eaa31c58}


Returns true if this thread writes date. 

Is used by \hyperlink{classmdt_port_thread_a5746ea96689ed80179751ad1353f0b39}{mdtPortThread::stop()} to know if \hyperlink{classmdt_abstract_port_ae67c815f68317c70e398eaa86622af6b}{mdtAbstractPort::abortFrameToWriteWait()} must be called.

Default implementation returns false 

Reimplemented in \hyperlink{classmdt_port_write_thread_ad2508c3a2433383e2de705e9f3d2e602}{mdtPortWriteThread}, \hyperlink{classmdt_tcp_socket_thread_a014ad2b3a5fbe7031eeb1d42d8f0767d}{mdtTcpSocketThread}, \hyperlink{classmdt_usb_port_thread_a74258f300967b5dea1fbfa9a0ccab38a}{mdtUsbPortThread}, and \hyperlink{classmdt_usbtmc_port_thread_a4c58b7140f0483a19723b14487907423}{mdtUsbtmcPortThread}.



Definition at line 193 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{
\index{mdtPortThread@{mdtPortThread}!newFrameReaden@{newFrameReaden}}
\index{newFrameReaden@{newFrameReaden}!mdtPortThread@{mdtPortThread}}
\subsubsection[{newFrameReaden}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::newFrameReaden (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}signal\mbox{]}}}}
\label{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}


Emited when a new frame is available. 

This signal is emited when a new frame is available.

To get the frame, the simplest way is to use a \hyperlink{classmdt_port_manager}{mdtPortManager}.

It's also possible to use \hyperlink{classmdt_port}{mdtPort}, but this solution needs to handle the mutex, verify the readen queue state, ...

\begin{DoxySeeAlso}{See also}
\hyperlink{classmdt_port_manager}{mdtPortManager} 

\hyperlink{classmdt_port}{mdtPort} 
\end{DoxySeeAlso}
\hypertarget{classmdt_port_thread_a37883c167ec85ff7a4996ffea5288ffe}{
\index{mdtPortThread@{mdtPortThread}!notifyError@{notifyError}}
\index{notifyError@{notifyError}!mdtPortThread@{mdtPortThread}}
\subsubsection[{notifyError}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::notifyError (
\begin{DoxyParamCaption}
\item[{int}]{error, }
\item[{bool}]{renotifySameError = {\ttfamily false}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_a37883c167ec85ff7a4996ffea5288ffe}


Emit the \hyperlink{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{errorOccured()} signal if new error is different from current. 


\begin{DoxyParams}{Parameters}
{\em renotifySameError} & For some cases, the same error must be notified each time it happens. If this flag is true, signal is emitted without checking previous error. \\
\hline
\end{DoxyParams}


Definition at line 495 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a8756fe2a26bf267376b4003a2896ff48}{
\index{mdtPortThread@{mdtPortThread}!readFromPort@{readFromPort}}
\index{readFromPort@{readFromPort}!mdtPortThread@{mdtPortThread}}
\subsubsection[{readFromPort}]{\setlength{\rightskip}{0pt plus 5cm}int mdtPortThread::readFromPort (
\begin{DoxyParamCaption}
\item[{{\bf mdtFrame} $\ast$$\ast$}]{frame, }
\item[{bool}]{emitNewFrameReaden = {\ttfamily true}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_a8756fe2a26bf267376b4003a2896ff48}


Read data from port. 

This is a helper method for subclass to store chunk of data into a frame.

Note about port mutex handling:\par
 The port mutex must be locked before calling this method. Internally, it will be unlocked during wait, and will be locked again. So, the port mutex is allways locked when this method returns.


\begin{DoxyParams}{Parameters}
{\em frame} & Data readen from port will be stored in this frame. Note that pointer is updated when a frame was completed and that it can be Null (in this case the \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85ea6e24e272af4da51c84eef5825c5cd712}{mdtAbstractPort::UnhandledError} is returned) \\
\hline
{\em emitNewFrameReaden} & If true, \hyperlink{classmdt_port_thread_a7fc2245c753fd65e1beffec211c41461}{newFrameReaden()} will be emitted each time a complete frame was generated. If false, complete frames are enqueued (as ever), but signal is not emitted. (This flag is used by \hyperlink{classmdt_usbtmc_port_thread}{mdtUsbtmcPortThread}).\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
The number of frames completed during the process. This can be helpful for query/reply protocols in witch the standard reply should be one frame. On error, frame is put back into pool and one of the \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} is returned.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 

frame must be a valid pointer (not Null).
\end{DoxyPrecond}
\begin{Desc}
\item[\hyperlink{todo__todo000030}{Todo}]Handle timeout error ? \end{Desc}


Definition at line 247 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_abb7234a12814f5c7c98bd6c1c2ccb776}{
\index{mdtPortThread@{mdtPortThread}!readProcessBegin@{readProcessBegin}}
\index{readProcessBegin@{readProcessBegin}!mdtPortThread@{mdtPortThread}}
\subsubsection[{readProcessBegin}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::readProcessBegin (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}signal\mbox{]}}}}
\label{classmdt_port_thread_abb7234a12814f5c7c98bd6c1c2ccb776}


Emitted when a read process begins. 

This can be used to display read state. Please consider that this signal is emitted each time the read process begins, and not when it ends. This is because asynch I/O calls are fast, and nothing will be seen from user if we update state before/after I/O call. To handle this, use this signal as trigger, and hold the state some stime (f.ex. 100 \mbox{[}ms\mbox{]}) \hypertarget{classmdt_port_thread_abee1d2f9b67ca37cfd13e108ca978b36}{
\index{mdtPortThread@{mdtPortThread}!reconnect@{reconnect}}
\index{reconnect@{reconnect}!mdtPortThread@{mdtPortThread}}
\subsubsection[{reconnect}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtAbstractPort::error\_\-t} mdtPortThread::reconnect (
\begin{DoxyParamCaption}
\item[{bool}]{notify = {\ttfamily true}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_abee1d2f9b67ca37cfd13e108ca978b36}


Try to reconnect to device/peer. 

This is a helper method for subclass. When a port method returns a Disconnected error, the thread can call this method, wich will try to reconnect (using \hyperlink{classmdt_abstract_port_aec74b2db1a629d98a95d8f042ea96653}{mdtAbstractPort::reconnect()} ) until max retry was reached.

Reconnect timeout and max try are readen from port config, in \hyperlink{classmdt_port_thread_a9c45f260b8d58b7475151df79b3d8510}{start()} method.


\begin{DoxyParams}{Parameters}
{\em notify} & If true, error will be notified (with \hyperlink{classmdt_port_thread_ab31cbe1a85aa830cd368654d1f806326}{errorOccured()} ), and failure after maxTry will be reported with \hyperlink{classmdt_error}{mdtError}. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
NoError if reconnection worked or UnhandledError else.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 
\end{DoxyPrecond}


Definition at line 450 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{
\index{mdtPortThread@{mdtPortThread}!setPort@{setPort}}
\index{setPort@{setPort}!mdtPortThread@{mdtPortThread}}
\subsubsection[{setPort}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::setPort (
\begin{DoxyParamCaption}
\item[{{\bf mdtAbstractPort} $\ast$}]{port}
\end{DoxyParamCaption}
)}}
\label{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}


Set the port instance. 

\begin{DoxyPrecond}{Precondition}
port must be a valid pointer 

The thread must not running 
\end{DoxyPrecond}


Definition at line 56 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a01d2362e0dfcece4cba242cb586d8d1c}{
\index{mdtPortThread@{mdtPortThread}!sigactionHandle@{sigactionHandle}}
\index{sigactionHandle@{sigactionHandle}!mdtPortThread@{mdtPortThread}}
\subsubsection[{sigactionHandle}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::sigactionHandle (
\begin{DoxyParamCaption}
\item[{int}]{signum}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}static, protected\mbox{]}}}}
\label{classmdt_port_thread_a01d2362e0dfcece4cba242cb586d8d1c}


qDebug() $<$$<$ \char`\"{}mdtPortThread::sigactionHandle() called, TID: \char`\"{} $<$$<$ pthread\_\-self(); 



Definition at line 505 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a9c45f260b8d58b7475151df79b3d8510}{
\index{mdtPortThread@{mdtPortThread}!start@{start}}
\index{start@{start}!mdtPortThread@{mdtPortThread}}
\subsubsection[{start}]{\setlength{\rightskip}{0pt plus 5cm}bool mdtPortThread::start (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{classmdt_port_thread_a9c45f260b8d58b7475151df79b3d8510}


Start the thread. 

\begin{DoxyReturn}{Returns}
True on sucsessfull start, or flase on start timeout
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port instance must be defined. 

Port must have a valid configuration. 
\end{DoxyPrecond}


Definition at line 74 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_a5746ea96689ed80179751ad1353f0b39}{
\index{mdtPortThread@{mdtPortThread}!stop@{stop}}
\index{stop@{stop}!mdtPortThread@{mdtPortThread}}
\subsubsection[{stop}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::stop (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual\mbox{]}}}}
\label{classmdt_port_thread_a5746ea96689ed80179751ad1353f0b39}


Stop the running thread. 

\begin{DoxyPrecond}{Precondition}
Port instance must be defined with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()}. 
\end{DoxyPrecond}


Reimplemented in \hyperlink{classmdt_port_write_thread_a69702ab3a95c238fb451f866efc7cb34}{mdtPortWriteThread}.



Definition at line 104 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_aa18ebea6a8791d228ab9575d1c68067c}{
\index{mdtPortThread@{mdtPortThread}!writeDataToPort@{writeDataToPort}}
\index{writeDataToPort@{writeDataToPort}!mdtPortThread@{mdtPortThread}}
\subsubsection[{writeDataToPort}]{\setlength{\rightskip}{0pt plus 5cm}qint64 mdtPortThread::writeDataToPort (
\begin{DoxyParamCaption}
\item[{{\bf mdtFrame} $\ast$}]{frame, }
\item[{int}]{maxSize = {\ttfamily -\/1}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_aa18ebea6a8791d228ab9575d1c68067c}


Write data to port. 

This is a helper method for subclass to write some data from a frame to the port.

Signal ioProcessBegin() is emitted.


\begin{DoxyParams}{Parameters}
{\em frame} & Data stored in this frame will be written to port. \\
\hline
{\em maxSize} & If $>$= 0, maxSize will be written, else the frame size will be considered. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Amount of bytes written or a \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} error.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 

frame must be a valid pointer (not Null). 
\end{DoxyPrecond}


Definition at line 335 of file mdtPortThread.cpp.

\hypertarget{classmdt_port_thread_aa01aac7e1a26deb823be40e6cb01b255}{
\index{mdtPortThread@{mdtPortThread}!writeProcessBegin@{writeProcessBegin}}
\index{writeProcessBegin@{writeProcessBegin}!mdtPortThread@{mdtPortThread}}
\subsubsection[{writeProcessBegin}]{\setlength{\rightskip}{0pt plus 5cm}void mdtPortThread::writeProcessBegin (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}signal\mbox{]}}}}
\label{classmdt_port_thread_aa01aac7e1a26deb823be40e6cb01b255}


Emitted when a write process begins. 

This can be used to display write state. Please consider that this signal is emitted each time the write process begins, and not when it ends. This is because asynch I/O calls are fast, and nothing will be seen from user if we update state before/after I/O call. To handle this, use this signal as trigger, and hold the state some stime (f.ex. 100 \mbox{[}ms\mbox{]}) \hypertarget{classmdt_port_thread_a2658d7f1a04ef10eb09d575d8d7eda43}{
\index{mdtPortThread@{mdtPortThread}!writeToPort@{writeToPort}}
\index{writeToPort@{writeToPort}!mdtPortThread@{mdtPortThread}}
\subsubsection[{writeToPort}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdtAbstractPort::error\_\-t} mdtPortThread::writeToPort (
\begin{DoxyParamCaption}
\item[{{\bf mdtFrame} $\ast$}]{frame, }
\item[{bool}]{bytePerByteWrite, }
\item[{int}]{interByteTime, }
\item[{int}]{maxWriteTry = {\ttfamily 10}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}protected\mbox{]}}}}
\label{classmdt_port_thread_a2658d7f1a04ef10eb09d575d8d7eda43}


Write a complete frame to port. 

This is a helper method for subclass to write a frame to the port. Internally, it will call \hyperlink{classmdt_abstract_port_a35e4686f50e2c53c7e3618cf2c485d92}{mdtAbstractPort::waitEventWriteReady()} before writing.

Note that frame will be put back to write pool after complete write, cancel or flush. That says that frame will not be valid after call of this method.

Note about port mutex handling:\par
 The port mutex must be locked before calling this method. Internally, it will be unlocked during wait, and will be locked again. So, the port mutex is allways locked when this method returns.


\begin{DoxyParams}{Parameters}
{\em frame} & Data stored in this frame will be written to port. \\
\hline
{\em bytePerByteWrite} & If true, one byte will be written once. \\
\hline
{\em interByteTime} & Time between each byte write \mbox{[}ms\mbox{]} (has only effect if bytePerByteWrite is true) \\
\hline
{\em maxWriteTry} & Some port can return 0 byte or a timeout error if busy. If this happens, this method will sleep some time an try a write call again until write call works successfull or maxWriteTry is reached.\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
NoError on success or a \hyperlink{classmdt_abstract_port_ad4121bb930c95887e77f8bafa065a85e}{mdtAbstractPort::error\_\-t} error.
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_thread_acd51474c3a2683676423317bc9cb31b2}{setPort()} before using this method. 

frame must be a valid pointer (not Null). 
\end{DoxyPrecond}


Definition at line 361 of file mdtPortThread.cpp.



The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
src/mdtport/mdtPortThread.h\item 
src/mdtport/mdtPortThread.cpp\end{DoxyCompactItemize}
