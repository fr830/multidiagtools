\hypertarget{classmdt_device_scpi}{\section{mdt\-Device\-Scpi Class Reference}
\label{classmdt_device_scpi}\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}}
}


Base class for S\-C\-P\-I based instruments.  




{\ttfamily \#include $<$mdt\-Device\-Scpi.\-h$>$}



Inheritance diagram for mdt\-Device\-Scpi\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=309pt]{classmdt_device_scpi__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdt\-Device\-Scpi\-:
\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=218pt]{classmdt_device_scpi__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_device_scpi_a44c03151a6796e5c1efd64ef55f2d14d}{mdt\-Device\-Scpi} (Q\-Object $\ast$parent=0)
\begin{DoxyCompactList}\small\item\em Construct a S\-C\-P\-I device. \end{DoxyCompactList}\item 
virtual \hyperlink{classmdt_device_scpi_ae173b9ad3d528005e124624ca9bb7b64}{$\sim$mdt\-Device\-Scpi} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_device_scpi_a94c8fde98a0fa2f933b3c069aa1e4fa0}{connect\-To\-Device} (uint16\-\_\-t id\-Vendor, uint16\-\_\-t id\-Product, const Q\-String \&serial\-Number)
\begin{DoxyCompactList}\small\item\em Connect to a U\-S\-B\-T\-M\-C device. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_device_scpi_a59759a6138c3ecbcb5cb98a042f8bcb5}{send\-Command} (const Q\-Byte\-Array \&command, int timeout=30000)
\begin{DoxyCompactList}\small\item\em Send a command to device. \end{DoxyCompactList}\item 
Q\-Byte\-Array \hyperlink{classmdt_device_scpi_a6dd5bd26c3178c5ba150d813a91e67c9}{send\-Query} (const Q\-Byte\-Array \&query, int timeout=30000)
\begin{DoxyCompactList}\small\item\em Send a query to device. \end{DoxyCompactList}\item 
\hyperlink{classmdt_error}{mdt\-Error} \hyperlink{classmdt_device_scpi_a45093d4dac06457ee088f45cbec79f3d}{get\-Device\-Error} (const Q\-String \&error\-Text=Q\-String())
\begin{DoxyCompactList}\small\item\em Get device error. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_device_scpi_aefd45e58d01aed9a165bb2c2dd98198c}{wait\-Operation\-Complete} (int timeout, int interval)
\begin{DoxyCompactList}\small\item\em Send a command to device. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Member Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_device_scpi_a32498c40ac609ac157cb332bc4e7ac51}{disconnect\-From\-Device\-Event} ()
\begin{DoxyCompactList}\small\item\em Close port. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_device_scpi_a750ebbf843bad40b442a9d965c6f0e44}{name\-Changed\-Event} (const Q\-String \&new\-Name)
\begin{DoxyCompactList}\small\item\em Update name in port. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Base class for S\-C\-P\-I based instruments. 

Most of current instruments (Agilent, N\-I, ...) support S\-C\-P\-I command format.

This class give some common functions requierd to handle such devices.

Currently, only U\-S\-B\-T\-M\-C port is supported. 

Definition at line 46 of file mdt\-Device\-Scpi.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_device_scpi_a44c03151a6796e5c1efd64ef55f2d14d}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!mdt\-Device\-Scpi@{mdt\-Device\-Scpi}}
\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{mdt\-Device\-Scpi}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Device\-Scpi\-::mdt\-Device\-Scpi (
\begin{DoxyParamCaption}
\item[{Q\-Object $\ast$}]{parent = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_a44c03151a6796e5c1efd64ef55f2d14d}


Construct a S\-C\-P\-I device. 

Will create and configure a U\-S\-B\-T\-M\-C port manager. 

Definition at line 32 of file mdt\-Device\-Scpi.\-cpp.

\hypertarget{classmdt_device_scpi_ae173b9ad3d528005e124624ca9bb7b64}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!$\sim$mdt\-Device\-Scpi@{$\sim$mdt\-Device\-Scpi}}
\index{$\sim$mdt\-Device\-Scpi@{$\sim$mdt\-Device\-Scpi}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{$\sim$mdt\-Device\-Scpi}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Device\-Scpi\-::$\sim$mdt\-Device\-Scpi (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_device_scpi_ae173b9ad3d528005e124624ca9bb7b64}


Destructor. 



Definition at line 43 of file mdt\-Device\-Scpi.\-cpp.



\subsection{Member Function Documentation}
\hypertarget{classmdt_device_scpi_a94c8fde98a0fa2f933b3c069aa1e4fa0}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!connect\-To\-Device@{connect\-To\-Device}}
\index{connect\-To\-Device@{connect\-To\-Device}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{connect\-To\-Device}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Device\-Scpi\-::connect\-To\-Device (
\begin{DoxyParamCaption}
\item[{uint16\-\_\-t}]{id\-Vendor, }
\item[{uint16\-\_\-t}]{id\-Product, }
\item[{const Q\-String \&}]{serial\-Number}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_a94c8fde98a0fa2f933b3c069aa1e4fa0}


Connect to a U\-S\-B\-T\-M\-C device. 


\begin{DoxyParams}{Parameters}
{\em id\-Vendor} & Vendor I\-D \\
\hline
{\em id\-Product} & Product I\-D \\
\hline
{\em serial\-Number} & Device serial number. Will be ignored if empty \\
\hline
\end{DoxyParams}


Definition at line 47 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Usbtmc\-Port\-::last\-Error(), mdt\-Usbtmc\-Port\-::open\-Device(), and mdt\-Device\-::pv\-Last\-Error.



Referenced by mdt\-Device\-D\-S\-O1000\-A\-::connect\-To\-Device(), and mdt\-Device\-U3606\-A\-::connect\-To\-Device().

\hypertarget{classmdt_device_scpi_a32498c40ac609ac157cb332bc4e7ac51}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!disconnect\-From\-Device\-Event@{disconnect\-From\-Device\-Event}}
\index{disconnect\-From\-Device\-Event@{disconnect\-From\-Device\-Event}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{disconnect\-From\-Device\-Event}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Device\-Scpi\-::disconnect\-From\-Device\-Event (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{classmdt_device_scpi_a32498c40ac609ac157cb332bc4e7ac51}


Close port. 



Reimplemented from \hyperlink{classmdt_device_afe3dec5b38bb5db7f5f6f250caa5f577}{mdt\-Device}.



Definition at line 128 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Usbtmc\-Port\-::close().

\hypertarget{classmdt_device_scpi_a45093d4dac06457ee088f45cbec79f3d}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!get\-Device\-Error@{get\-Device\-Error}}
\index{get\-Device\-Error@{get\-Device\-Error}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{get\-Device\-Error}]{\setlength{\rightskip}{0pt plus 5cm}{\bf mdt\-Error} mdt\-Device\-Scpi\-::get\-Device\-Error (
\begin{DoxyParamCaption}
\item[{const Q\-String \&}]{error\-Text = {\ttfamily QString()}}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_a45093d4dac06457ee088f45cbec79f3d}


Get device error. 

Will send S\-Y\-S\-Tem\-:E\-R\-Ror? query and return error. On (communication) problem, error level will be set to No\-Error.


\begin{DoxyParams}{Parameters}
{\em error\-Text} & Text to set in error. If empty, a default text will be set. \\
\hline
\end{DoxyParams}


Definition at line 74 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Codec\-Scpi\-::decode\-Device\-Error(), and send\-Query().

\hypertarget{classmdt_device_scpi_a750ebbf843bad40b442a9d965c6f0e44}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!name\-Changed\-Event@{name\-Changed\-Event}}
\index{name\-Changed\-Event@{name\-Changed\-Event}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{name\-Changed\-Event}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Device\-Scpi\-::name\-Changed\-Event (
\begin{DoxyParamCaption}
\item[{const Q\-String \&}]{new\-Name}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [virtual]}}}\label{classmdt_device_scpi_a750ebbf843bad40b442a9d965c6f0e44}


Update name in port. 



Reimplemented from \hyperlink{classmdt_device_a30b8db129316183a10d38a569d431c92}{mdt\-Device}.



Definition at line 134 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Usbtmc\-Port\-::set\-Device\-Name().

\hypertarget{classmdt_device_scpi_a59759a6138c3ecbcb5cb98a042f8bcb5}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!send\-Command@{send\-Command}}
\index{send\-Command@{send\-Command}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{send\-Command}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Device\-Scpi\-::send\-Command (
\begin{DoxyParamCaption}
\item[{const Q\-Byte\-Array \&}]{command, }
\item[{int}]{timeout = {\ttfamily 30000}}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_a59759a6138c3ecbcb5cb98a042f8bcb5}


Send a command to device. 


\begin{DoxyParams}{Parameters}
{\em command} & Command to send \\
\hline
{\em timeout} & Timeout \mbox{[}ms\mbox{]} \\
\hline
\end{DoxyParams}


Definition at line 56 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Usbtmc\-Port\-::last\-Error(), mdt\-Device\-::pv\-Last\-Error, and mdt\-Usbtmc\-Port\-::send\-Command().



Referenced by mdt\-Device\-U3606\-A\-::set\-Output\-State(), mdt\-Device\-U3606\-A\-::set\-Source\-Current(), mdt\-Device\-U3606\-A\-::set\-Source\-Range(), mdt\-Device\-U3606\-A\-::set\-Source\-Voltage\-Limit(), mdt\-Device\-U3606\-A\-::setup\-Low\-Resistance\-Measure(), mdt\-Device\-U3606\-A\-::setup\-Resistance\-Measure(), and mdt\-Device\-U3606\-A\-::setup\-Voltage\-Dc\-Measure().

\hypertarget{classmdt_device_scpi_a6dd5bd26c3178c5ba150d813a91e67c9}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!send\-Query@{send\-Query}}
\index{send\-Query@{send\-Query}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{send\-Query}]{\setlength{\rightskip}{0pt plus 5cm}Q\-Byte\-Array mdt\-Device\-Scpi\-::send\-Query (
\begin{DoxyParamCaption}
\item[{const Q\-Byte\-Array \&}]{query, }
\item[{int}]{timeout = {\ttfamily 30000}}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_a6dd5bd26c3178c5ba150d813a91e67c9}


Send a query to device. 


\begin{DoxyParams}{Parameters}
{\em query} & Query to send \\
\hline
{\em timeout} & Timeout \mbox{[}ms\mbox{]} \\
\hline
\end{DoxyParams}


Definition at line 65 of file mdt\-Device\-Scpi.\-cpp.



References mdt\-Usbtmc\-Port\-::last\-Error(), mdt\-Device\-::pv\-Last\-Error, and mdt\-Usbtmc\-Port\-::send\-Query().



Referenced by get\-Device\-Error(), mdt\-Device\-U3606\-A\-::get\-Measure\-Configuration(), mdt\-Device\-U3606\-A\-::get\-Measure\-Value(), and wait\-Operation\-Complete().

\hypertarget{classmdt_device_scpi_aefd45e58d01aed9a165bb2c2dd98198c}{\index{mdt\-Device\-Scpi@{mdt\-Device\-Scpi}!wait\-Operation\-Complete@{wait\-Operation\-Complete}}
\index{wait\-Operation\-Complete@{wait\-Operation\-Complete}!mdtDeviceScpi@{mdt\-Device\-Scpi}}
\subsubsection[{wait\-Operation\-Complete}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Device\-Scpi\-::wait\-Operation\-Complete (
\begin{DoxyParamCaption}
\item[{int}]{timeout, }
\item[{int}]{interval}
\end{DoxyParamCaption}
)}}\label{classmdt_device_scpi_aefd45e58d01aed9a165bb2c2dd98198c}


Send a command to device. 

Wait until it's possible to write to device, then send the command.

Note that the wait will not break the G\-U\-I's event loop (see mdt\-Port\-Manager\-::wait\-On\-Write\-Ready() for details).

This method will not update internal device state. It's recommended to use \hyperlink{classmdt_device}{mdt\-Device} functions if available.


\begin{DoxyParams}{Parameters}
{\em command} & Command to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
b\-Tag on success, or a error $<$ 0 (see mdt\-Usbtmc\-Port\-Manager\-::write\-Data() for details).int send\-Command(const Q\-Byte\-Array \&command);
\end{DoxyReturn}
Send a query to device

Wait until it's possible to write to device, send the query and wait until a response is available or timeout.

Note that the wait will not break the G\-U\-I's event loop.

This method will not update internal device and I/\-O states. It's recommended to use \hyperlink{classmdt_device}{mdt\-Device} functions if available.


\begin{DoxyParams}{Parameters}
{\em query} & Query to send. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Result as string (empty string on error) Note that \hyperlink{classmdt_frame_codec_scpi}{mdt\-Frame\-Codec\-Scpi} can be helpful to decode returned result.\-Q\-Byte\-Array send\-Query(const Q\-Byte\-Array \&query);
\end{DoxyReturn}
Wait until operation is complete (Using $\ast$\-O\-P\-C? query)

Currently, this method queries device with $\ast$\-O\-P\-C?.


\begin{DoxyParams}{Parameters}
{\em timeout} & Timeout \mbox{[}ms\mbox{]} \\
\hline
{\em interval} & Interval between 2 $\ast$\-O\-P\-C? query \mbox{[}ms\mbox{]} \\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}
interval $>$ 0 
\end{DoxyPrecond}


Definition at line 87 of file mdt\-Device\-Scpi.\-cpp.



References send\-Query().



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/mdtdevice/\hyperlink{mdt_device_scpi_8h}{mdt\-Device\-Scpi.\-h}\item 
src/mdtdevice/\hyperlink{mdt_device_scpi_8cpp}{mdt\-Device\-Scpi.\-cpp}\end{DoxyCompactItemize}
