\hypertarget{classmdt_usb_port_manager}{\section{mdt\-Usb\-Port\-Manager Class Reference}
\label{classmdt_usb_port_manager}\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}}
}


Helper class that simplify access to U\-S\-B port A\-P\-I.  




{\ttfamily \#include $<$mdt\-Usb\-Port\-Manager.\-h$>$}



Inheritance diagram for mdt\-Usb\-Port\-Manager\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=202pt]{classmdt_usb_port_manager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdt\-Usb\-Port\-Manager\-:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=350pt]{classmdt_usb_port_manager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_usb_port_manager_af043c75c74665b23d13f3cb73150935c}{from\-Thread\-Control\-Response\-Readen} ()
\begin{DoxyCompactList}\small\item\em Called from U\-S\-B thread when a control reply was received. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_usb_port_manager_a9b7154590a4eb267aff4e11ba53dd7aa}{from\-Thread\-Message\-In\-Readen} ()
\begin{DoxyCompactList}\small\item\em Called from U\-S\-B thread when a message I\-N was received ( on additionnal interrupt I\-N endpoint). \end{DoxyCompactList}\item 
void \hyperlink{classmdt_usb_port_manager_a8f53dc5445b7f8f4a077f3cc25880b5d}{from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished} ()
\begin{DoxyCompactList}\small\item\em Called by thread when the read until a short packet process is finished. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_usb_port_manager_a7f82574e84d0a99d1c8bef7fd79283e3}{mdt\-Usb\-Port\-Manager} (\hyperlink{class_q_object}{Q\-Object} $\ast$parent=0)
\begin{DoxyCompactList}\small\item\em Contruct a U\-S\-B port manager. \end{DoxyCompactList}\item 
virtual \hyperlink{classmdt_usb_port_manager_ac0da1cf62e664b78fe91b873da5835ce}{$\sim$mdt\-Usb\-Port\-Manager} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
virtual Q\-List$<$ \hyperlink{classmdt_port_info}{mdt\-Port\-Info} $\ast$ $>$ \hyperlink{classmdt_usb_port_manager_a3a2370c3a2d0353a880bf9b777728c3b}{scan} ()
\begin{DoxyCompactList}\small\item\em Get a list of attached U\-S\-B devices. \end{DoxyCompactList}\item 
Q\-List$<$ \hyperlink{classmdt_port_info}{mdt\-Port\-Info} $\ast$ $>$ \hyperlink{classmdt_usb_port_manager_ab28253c46c80bb12cbbd116b05c4bcd3}{scan} (int b\-Device\-Class, int b\-Device\-Sub\-Class, int b\-Device\-Protocol)
\begin{DoxyCompactList}\small\item\em Get a list of attached U\-S\-B devices. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_usb_port_manager_ac656805c6de08c9c6a2487291cf3f347}{start} ()
\begin{DoxyCompactList}\small\item\em Open the port. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_usb_port_manager_adff8a1f8ed2b0e68229e2016c75e04a6}{read\-Until\-Short\-Packet\-Received} ()
\begin{DoxyCompactList}\small\item\em Check if port manager is ready. \end{DoxyCompactList}\item 
virtual int \hyperlink{classmdt_usb_port_manager_aea4a67550effcba13acfc110d6d30c3e}{send\-Control\-Request} (const \hyperlink{classmdt_frame_usb_control}{mdt\-Frame\-Usb\-Control} \&request, bool setw\-Index\-Asb\-Interface\-Number=false)
\begin{DoxyCompactList}\small\item\em Send a control request by copy. \end{DoxyCompactList}\item 
bool \hyperlink{classmdt_usb_port_manager_a34bf0ac118e586bf2547a98964a2230c}{wait\-Readen\-Control\-Response} ()
\begin{DoxyCompactList}\small\item\em Wait until a control response is readen. \end{DoxyCompactList}\item 
Q\-List$<$ \hyperlink{classmdt_frame_usb_control}{mdt\-Frame\-Usb\-Control} $>$ \hyperlink{classmdt_usb_port_manager_a84c26fee7dfb26290659aa002e0842c6}{readen\-Control\-Responses} ()
\begin{DoxyCompactList}\small\item\em Get all readen control responses. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_usb_port_manager_a982256ed17db155e1c95d544683a6dba}{flush\-In} (bool flush\-Port\-Manager\-Buffers, bool flush\-Port\-Buffers)
\begin{DoxyCompactList}\small\item\em Flush input buffers. \end{DoxyCompactList}\item 
void \hyperlink{classmdt_usb_port_manager_ab723086376175c40635df44adf358985}{flush\-Out} (bool flush\-Port\-Manager\-Buffers, bool flush\-Port\-Buffers)
\begin{DoxyCompactList}\small\item\em Flush output buffers. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Protected Slots}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_usb_port_manager_ad6cbef2c218efe73fdad6d5f598f743f}{on\-Threads\-Error\-Occured} (int error)
\begin{DoxyCompactList}\small\item\em Manage errors comming from usb port thread. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Additional Inherited Members}


\subsection{Detailed Description}
Helper class that simplify access to U\-S\-B port A\-P\-I. 

Based on \hyperlink{classmdt_port_manager}{mdt\-Port\-Manager}, some U\-S\-B specific methods are added. The internal configuration (a \hyperlink{classmdt_port_config}{mdt\-Port\-Config} object) is keeped default. 

Definition at line 33 of file mdt\-Usb\-Port\-Manager.\-h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_usb_port_manager_a7f82574e84d0a99d1c8bef7fd79283e3}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}}
\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{mdt\-Usb\-Port\-Manager}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Usb\-Port\-Manager\-::mdt\-Usb\-Port\-Manager (
\begin{DoxyParamCaption}
\item[{{\bf Q\-Object} $\ast$}]{parent = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}\label{classmdt_usb_port_manager_a7f82574e84d0a99d1c8bef7fd79283e3}


Contruct a U\-S\-B port manager. 

Will create \hyperlink{classmdt_usb_port}{mdt\-Usb\-Port} and setup. Thread will be created at first call of \hyperlink{classmdt_port_manager_aab594613e8985590c835194efbc27b5e}{open\-Port()}. 

Definition at line 34 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::config(), mdt\-Abstract\-Port\-::set\-Config(), and mdt\-Port\-Manager\-::set\-Port().

\hypertarget{classmdt_usb_port_manager_ac0da1cf62e664b78fe91b873da5835ce}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!$\sim$mdt\-Usb\-Port\-Manager@{$\sim$mdt\-Usb\-Port\-Manager}}
\index{$\sim$mdt\-Usb\-Port\-Manager@{$\sim$mdt\-Usb\-Port\-Manager}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{$\sim$mdt\-Usb\-Port\-Manager}]{\setlength{\rightskip}{0pt plus 5cm}mdt\-Usb\-Port\-Manager\-::$\sim$mdt\-Usb\-Port\-Manager (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_ac0da1cf62e664b78fe91b873da5835ce}


Destructor. 

Stop the manager (if running), and close the port (if open). All internal objects (port, config and threads) are deleted here. 

Definition at line 47 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Abstract\-Port\-::config(), mdt\-Port\-Manager\-::detach\-Port(), mdt\-Port\-Manager\-::pv\-Port, and mdt\-Port\-Manager\-::stop().



\subsection{Member Function Documentation}
\hypertarget{classmdt_usb_port_manager_a982256ed17db155e1c95d544683a6dba}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!flush\-In@{flush\-In}}
\index{flush\-In@{flush\-In}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{flush\-In}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::flush\-In (
\begin{DoxyParamCaption}
\item[{bool}]{flush\-Port\-Manager\-Buffers, }
\item[{bool}]{flush\-Port\-Buffers}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_a982256ed17db155e1c95d544683a6dba}


Flush input buffers. 


\begin{DoxyParams}{Parameters}
{\em flush\-Port\-Manager\-Buffers} & If true, port manager buffers will be cleared. \\
\hline
{\em flush\-Port\-Buffers} & If true, port's buffers will be cleared. \\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} before calling this method. 
\end{DoxyPrecond}


Reimplemented from \hyperlink{classmdt_port_manager_ac0844a5cd4043a95a479d458ac7ce590}{mdt\-Port\-Manager}.



Definition at line 342 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::flush\-In(), and mdt\-Port\-Manager\-::pv\-Port.

\hypertarget{classmdt_usb_port_manager_ab723086376175c40635df44adf358985}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!flush\-Out@{flush\-Out}}
\index{flush\-Out@{flush\-Out}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{flush\-Out}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::flush\-Out (
\begin{DoxyParamCaption}
\item[{bool}]{flush\-Port\-Manager\-Buffers, }
\item[{bool}]{flush\-Port\-Buffers}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_ab723086376175c40635df44adf358985}


Flush output buffers. 


\begin{DoxyParams}{Parameters}
{\em flush\-Port\-Manager\-Buffers} & If true, port manager buffers will be cleared. (Has no effect in this implementation, but some subclass can have output buffers). \\
\hline
{\em flush\-Port\-Buffers} & If true, port's buffers will be cleared. \\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} before calling this method. 
\end{DoxyPrecond}


Reimplemented from \hyperlink{classmdt_port_manager_a3f0c2722a41c49de2bea9013bccd049c}{mdt\-Port\-Manager}.



Definition at line 353 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::flush\-Out(), and mdt\-Port\-Manager\-::pv\-Port.

\hypertarget{classmdt_usb_port_manager_af043c75c74665b23d13f3cb73150935c}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!from\-Thread\-Control\-Response\-Readen@{from\-Thread\-Control\-Response\-Readen}}
\index{from\-Thread\-Control\-Response\-Readen@{from\-Thread\-Control\-Response\-Readen}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{from\-Thread\-Control\-Response\-Readen}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::from\-Thread\-Control\-Response\-Readen (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [slot]}}}\label{classmdt_usb_port_manager_af043c75c74665b23d13f3cb73150935c}


Called from U\-S\-B thread when a control reply was received. 

Will add a copy of received control responses to internal queue and restore frame back to port's pool. 

Definition at line 360 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Error\-::commit(), mdt\-Usb\-Port\-::control\-Frames\-Pool(), mdt\-Usb\-Port\-::control\-Response\-Frames(), mdt\-Error\-::\-Error, mdt\-Port\-Manager\-::lock\-Port\-Mutex(), M\-D\-T\-\_\-\-E\-R\-R\-O\-R\-\_\-\-S\-E\-T\-\_\-\-S\-R\-C, M\-D\-T\-\_\-\-U\-S\-B\-\_\-\-I\-O\-\_\-\-E\-R\-R\-O\-R, mdt\-Port\-Manager\-::pv\-Port, and mdt\-Port\-Manager\-::unlock\-Port\-Mutex().



Referenced by start().

\hypertarget{classmdt_usb_port_manager_a9b7154590a4eb267aff4e11ba53dd7aa}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!from\-Thread\-Message\-In\-Readen@{from\-Thread\-Message\-In\-Readen}}
\index{from\-Thread\-Message\-In\-Readen@{from\-Thread\-Message\-In\-Readen}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{from\-Thread\-Message\-In\-Readen}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::from\-Thread\-Message\-In\-Readen (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [slot]}}}\label{classmdt_usb_port_manager_a9b7154590a4eb267aff4e11ba53dd7aa}


Called from U\-S\-B thread when a message I\-N was received ( on additionnal interrupt I\-N endpoint). 



Definition at line 394 of file mdt\-Usb\-Port\-Manager.\-cpp.

\hypertarget{classmdt_usb_port_manager_a8f53dc5445b7f8f4a077f3cc25880b5d}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished@{from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished}}
\index{from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished@{from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::from\-Thread\-Read\-Until\-Short\-Packet\-Received\-Finished (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [slot]}}}\label{classmdt_usb_port_manager_a8f53dc5445b7f8f4a077f3cc25880b5d}


Called by thread when the read until a short packet process is finished. 



Definition at line 399 of file mdt\-Usb\-Port\-Manager.\-cpp.

\hypertarget{classmdt_usb_port_manager_ad6cbef2c218efe73fdad6d5f598f743f}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!on\-Threads\-Error\-Occured@{on\-Threads\-Error\-Occured}}
\index{on\-Threads\-Error\-Occured@{on\-Threads\-Error\-Occured}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{on\-Threads\-Error\-Occured}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::on\-Threads\-Error\-Occured (
\begin{DoxyParamCaption}
\item[{int}]{error}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [protected]}, {\ttfamily [slot]}}}\label{classmdt_usb_port_manager_ad6cbef2c218efe73fdad6d5f598f743f}


Manage errors comming from usb port thread. 

This implementation will handle some U\-S\-B specific errors, change the current state emiting transistion signal. If state has changed, \hyperlink{classmdt_port_manager_a01da0634bc52a71c0df0d83fc166eeda}{state\-Changed()} signal is emited.

Some errors are handled here. For others, \hyperlink{classmdt_port_manager_a7e45b8e3475e5182ed12218616664d07}{mdt\-Port\-Manager\-::on\-Threads\-Error\-Occured()} is called. 

Definition at line 405 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Abstract\-Port\-::\-Control\-Canceled, mdt\-Abstract\-Port\-::\-Control\-Timeout, mdt\-Port\-Manager\-::on\-Threads\-Error\-Occured(), mdt\-Port\-Manager\-::pm\-Unhandled\-Error\-Event(), and mdt\-Abstract\-Port\-::\-Unhandled\-Error.

\hypertarget{classmdt_usb_port_manager_a84c26fee7dfb26290659aa002e0842c6}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!readen\-Control\-Responses@{readen\-Control\-Responses}}
\index{readen\-Control\-Responses@{readen\-Control\-Responses}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{readen\-Control\-Responses}]{\setlength{\rightskip}{0pt plus 5cm}Q\-List$<$ {\bf mdt\-Frame\-Usb\-Control} $>$ mdt\-Usb\-Port\-Manager\-::readen\-Control\-Responses (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_usb_port_manager_a84c26fee7dfb26290659aa002e0842c6}


Get all readen control responses. 

Note that calling this methode will clear the internal queue. (A second call will return a empty list). 

Definition at line 332 of file mdt\-Usb\-Port\-Manager.\-cpp.

\hypertarget{classmdt_usb_port_manager_adff8a1f8ed2b0e68229e2016c75e04a6}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!read\-Until\-Short\-Packet\-Received@{read\-Until\-Short\-Packet\-Received}}
\index{read\-Until\-Short\-Packet\-Received@{read\-Until\-Short\-Packet\-Received}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{read\-Until\-Short\-Packet\-Received}]{\setlength{\rightskip}{0pt plus 5cm}void mdt\-Usb\-Port\-Manager\-::read\-Until\-Short\-Packet\-Received (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_usb_port_manager_adff8a1f8ed2b0e68229e2016c75e04a6}


Check if port manager is ready. 

Because \hyperlink{classmdt_usb_port_manager}{mdt\-Usb\-Port\-Manager} is a base class, it acts like \hyperlink{classmdt_port_manager_a6dc2798324521d177fb8f79d4f6c5f0f}{mdt\-Port\-Manager\-::is\-Ready()} . A specific subclass (like \hyperlink{classmdt_usbtmc_port_manager}{mdt\-Usbtmc\-Port\-Manager} will reimplement \hyperlink{classmdt_port_manager_a6dc2798324521d177fb8f79d4f6c5f0f}{is\-Ready()} ).

Request port to read until a short frame is received

This is, for example, used by U\-S\-B\-T\-M\-C bulk in abort process. If such request is pending, thread will read until a short frame is received.

Will send the request and wait until it is finished (will not break G\-U\-I event loop).

\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} with a \hyperlink{classmdt_usb_port}{mdt\-Usb\-Port} (or subclass) before use of this method. 
\end{DoxyPrecond}


Definition at line 206 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::is\-Closed(), mdt\-Port\-Manager\-::lock\-Port\-Mutex(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Usb\-Port\-::request\-Read\-Until\-Short\-Packet\-Received(), and mdt\-Port\-Manager\-::unlock\-Port\-Mutex().

\hypertarget{classmdt_usb_port_manager_a3a2370c3a2d0353a880bf9b777728c3b}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!scan@{scan}}
\index{scan@{scan}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{scan}]{\setlength{\rightskip}{0pt plus 5cm}Q\-List$<$ {\bf mdt\-Port\-Info} $\ast$ $>$ mdt\-Usb\-Port\-Manager\-::scan (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_a3a2370c3a2d0353a880bf9b777728c3b}


Get a list of attached U\-S\-B devices. 

Note that returned list must be freed by user after usage. (for.\-ex. with q\-Delet\-All() and Q\-List\-::clear() ).

\begin{DoxyPrecond}{Precondition}
Port manager must be closed 
\end{DoxyPrecond}


Reimplemented from \hyperlink{classmdt_port_manager_ad56afb411ab5468005fca04767557ece}{mdt\-Port\-Manager}.



Reimplemented in \hyperlink{classmdt_usbtmc_port_manager_a992d1227810186d3c7dc166452e2e3b6}{mdt\-Usbtmc\-Port\-Manager}.



Definition at line 56 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::is\-Closed(), and scan().



Referenced by scan(), and mdt\-Usbtmc\-Port\-Manager\-::scan().

\hypertarget{classmdt_usb_port_manager_ab28253c46c80bb12cbbd116b05c4bcd3}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!scan@{scan}}
\index{scan@{scan}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{scan}]{\setlength{\rightskip}{0pt plus 5cm}Q\-List$<$ {\bf mdt\-Port\-Info} $\ast$ $>$ mdt\-Usb\-Port\-Manager\-::scan (
\begin{DoxyParamCaption}
\item[{int}]{b\-Device\-Class, }
\item[{int}]{b\-Device\-Sub\-Class, }
\item[{int}]{b\-Device\-Protocol}
\end{DoxyParamCaption}
)}}\label{classmdt_usb_port_manager_ab28253c46c80bb12cbbd116b05c4bcd3}


Get a list of attached U\-S\-B devices. 

Note that returned list must be freed by user after usage. (for.\-ex. with q\-Delet\-All() and Q\-List\-::clear() ).


\begin{DoxyParams}{Parameters}
{\em b\-Device\-Class} & If $>$= 0, only devices with matching b\-Device\-Class are listed \\
\hline
{\em b\-Device\-Sub\-Class} & If $>$= 0, only devices with matching b\-Device\-Sub\-Class are listed \\
\hline
{\em b\-Device\-Protocol} & If $>$= 0, only devices with matching b\-Device\-Protocol are listed\\
\hline
\end{DoxyParams}
\begin{DoxyPrecond}{Precondition}
Port manager must be closed 
\end{DoxyPrecond}


Definition at line 63 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Info\-::add\-Device(), mdt\-Usb\-Interface\-Descriptor\-::b\-Interface\-Class(), mdt\-Usb\-Interface\-Descriptor\-::b\-Interface\-Protocol(), mdt\-Usb\-Interface\-Descriptor\-::b\-Interface\-Sub\-Class(), mdt\-Error\-::commit(), mdt\-Usb\-Device\-Descriptor\-::configurations(), mdt\-Port\-Info\-::device\-Info\-List(), mdt\-Error\-::\-Error, mdt\-Usb\-Device\-Descriptor\-::fetch\-Attributes(), mdt\-Usb\-Device\-Descriptor\-::id\-Product(), mdt\-Usb\-Device\-Descriptor\-::id\-Vendor(), mdt\-Usb\-Config\-Descriptor\-::interfaces(), mdt\-Port\-Manager\-::is\-Closed(), M\-D\-T\-\_\-\-E\-R\-R\-O\-R\-\_\-\-S\-E\-T\-\_\-\-S\-R\-C, M\-D\-T\-\_\-\-U\-S\-B\-\_\-\-I\-O\-\_\-\-E\-R\-R\-O\-R, mdt\-Port\-Manager\-::port\-Info(), mdt\-Port\-Manager\-::port\-Name(), mdt\-Device\-Info\-::product\-Id(), mdt\-Usb\-Device\-Descriptor\-::product\-Name(), mdt\-Usb\-Device\-Descriptor\-::serial\-Number(), mdt\-Port\-Info\-::set\-Display\-Text(), mdt\-Port\-Info\-::set\-Port\-Name(), mdt\-Device\-Info\-::set\-Product\-Id(), mdt\-Device\-Info\-::set\-Protocol\-Id(), mdt\-Device\-Info\-::set\-Serial\-Id(), mdt\-Device\-Info\-::set\-Vendor\-Id(), mdt\-Device\-Info\-::vendor\-Id(), and mdt\-Usb\-Device\-Descriptor\-::vendor\-Name().

\hypertarget{classmdt_usb_port_manager_aea4a67550effcba13acfc110d6d30c3e}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!send\-Control\-Request@{send\-Control\-Request}}
\index{send\-Control\-Request@{send\-Control\-Request}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{send\-Control\-Request}]{\setlength{\rightskip}{0pt plus 5cm}int mdt\-Usb\-Port\-Manager\-::send\-Control\-Request (
\begin{DoxyParamCaption}
\item[{const {\bf mdt\-Frame\-Usb\-Control} \&}]{request, }
\item[{bool}]{setw\-Index\-Asb\-Interface\-Number = {\ttfamily false}}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_aea4a67550effcba13acfc110d6d30c3e}


Send a control request by copy. 

Request will be passed to the \hyperlink{classmdt_port}{mdt\-Port}'s control request queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.


\begin{DoxyParams}{Parameters}
{\em frame} & Frame containing request to send. \\
\hline
{\em setw\-Index\-Asb\-Interface\-Number} & If true, w\-Index will be set with U\-S\-B port's current b\-Interface\-Number \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
0 on success or value $<$ 0 on error. In this implementation, the only possible error is mdt\-Abstract\-Port\-::\-Write\-Queue\-Empty . Some subclass can return a frame I\-D on success, or a other error. See subclass documentation for details. 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{set\-Port()} with a \hyperlink{classmdt_usb_port}{mdt\-Usb\-Port} (or subclass) before use of this method.
\end{DoxyPrecond}
Subclass notes\-:\par
 This method can be reimplemented in subclass if needed. Typically usefull if a frame I\-D must be generated for each request (f.\-ex. b\-Tag on U\-S\-B\-T\-M\-C). A frame must be taken from port's request frames pool with mdt\-Abstract\-Port\-::control\-Frames\-Pool() dequeue() method (see Qt's Q\-Queue documentation for more details on dequeue() ), then added to port's request queue with mdt\-Abstract\-Port\-::add\-Control\-Request() . If protocol supports frame identification (like U\-S\-B\-T\-M\-C's b\-Tag), it should be returned here and incremented. 

Definition at line 236 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Usb\-Port\-::add\-Control\-Request(), mdt\-Frame\-Usb\-Control\-::bm\-Request\-Type(), mdt\-Frame\-Usb\-Control\-::b\-Request(), mdt\-Frame\-::clear(), mdt\-Frame\-Usb\-Control\-::clear\-Sub(), mdt\-Abstract\-Port\-::\-Control\-Canceled, mdt\-Usb\-Port\-::control\-Frames\-Pool(), mdt\-Frame\-Usb\-Control\-::direction\-Is\-Device\-To\-Host(), mdt\-Frame\-Usb\-Control\-::encode(), mdt\-Port\-Manager\-::is\-Closed(), mdt\-Port\-Manager\-::is\-Ready(), mdt\-Port\-Manager\-::lock\-Port\-Mutex(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Frame\-Usb\-Control\-::setbm\-Request\-Type(), mdt\-Frame\-Usb\-Control\-::setb\-Request(), mdt\-Frame\-Usb\-Control\-::set\-Direction\-Device\-To\-Host(), mdt\-Frame\-Usb\-Control\-::setw\-Index(), mdt\-Frame\-Usb\-Control\-::setw\-Length(), mdt\-Frame\-Usb\-Control\-::setw\-Value(), mdt\-Port\-Manager\-::unlock\-Port\-Mutex(), mdt\-Frame\-Usb\-Control\-::w\-Index(), mdt\-Frame\-Usb\-Control\-::w\-Length(), and mdt\-Frame\-Usb\-Control\-::w\-Value().



Referenced by mdt\-Usbtmc\-Port\-Manager\-::send\-Read\-Status\-Byte\-Request().

\hypertarget{classmdt_usb_port_manager_ac656805c6de08c9c6a2487291cf3f347}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!start@{start}}
\index{start@{start}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{start}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Usb\-Port\-Manager\-::start (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily [virtual]}}}\label{classmdt_usb_port_manager_ac656805c6de08c9c6a2487291cf3f347}


Open the port. 

Overloads \hyperlink{classmdt_port_manager_af1fb103ffafc227337a59c7e82f44fbc}{mdt\-Port\-Manager\-::start()}.

Will construct the thread if not allready exists. This is because \hyperlink{classmdt_usbtmc_port_manager}{mdt\-Usbtmc\-Port\-Manager} uses a different thread, so this task can not be done in constructor.

Internally, \hyperlink{classmdt_port_manager_af1fb103ffafc227337a59c7e82f44fbc}{mdt\-Port\-Manager\-::start()} is called. 

Reimplemented from \hyperlink{classmdt_port_manager_af1fb103ffafc227337a59c7e82f44fbc}{mdt\-Port\-Manager}.



Definition at line 181 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::add\-Thread(), from\-Thread\-Control\-Response\-Readen(), mdt\-Port\-Manager\-::pv\-Port, mdt\-Port\-Manager\-::pv\-Threads, mdt\-Usb\-Port\-Thread\-::set\-Port(), mdt\-Port\-Manager\-::start(), and mdt\-Usb\-Port\-Thread\-::usb\-Port().

\hypertarget{classmdt_usb_port_manager_a34bf0ac118e586bf2547a98964a2230c}{\index{mdt\-Usb\-Port\-Manager@{mdt\-Usb\-Port\-Manager}!wait\-Readen\-Control\-Response@{wait\-Readen\-Control\-Response}}
\index{wait\-Readen\-Control\-Response@{wait\-Readen\-Control\-Response}!mdtUsbPortManager@{mdt\-Usb\-Port\-Manager}}
\subsubsection[{wait\-Readen\-Control\-Response}]{\setlength{\rightskip}{0pt plus 5cm}bool mdt\-Usb\-Port\-Manager\-::wait\-Readen\-Control\-Response (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}\label{classmdt_usb_port_manager_a34bf0ac118e586bf2547a98964a2230c}


Wait until a control response is readen. 

This method will return when a control response was readen.

Internally, a couple of sleep and process event are called, so Qt's event loop will not be broken.

This method can return if timeout occurs, or for other reason depending on specific port (port timeout, read canceled, ...).

\begin{DoxyReturn}{Returns}
True if Ok, false on timeout
\end{DoxyReturn}
\begin{DoxyRefDesc}{Todo}
\item[\hyperlink{todo__todo000035}{Todo}]Adapt using internal timeouts + errors system \end{DoxyRefDesc}


Definition at line 293 of file mdt\-Usb\-Port\-Manager.\-cpp.



References mdt\-Port\-Manager\-::is\-Closed(), and mdt\-Port\-Manager\-::pv\-Port.



The documentation for this class was generated from the following files\-:\begin{DoxyCompactItemize}
\item 
src/mdtport/\hyperlink{mdt_usb_port_manager_8h}{mdt\-Usb\-Port\-Manager.\-h}\item 
src/mdtport/\hyperlink{mdt_usb_port_manager_8cpp}{mdt\-Usb\-Port\-Manager.\-cpp}\end{DoxyCompactItemize}
