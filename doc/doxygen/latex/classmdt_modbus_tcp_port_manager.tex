\hypertarget{classmdt_modbus_tcp_port_manager}{
\section{mdtModbusTcpPortManager Class Reference}
\label{classmdt_modbus_tcp_port_manager}\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
}


MODBUS/TCP port manager.  




{\ttfamily \#include $<$mdtModbusTcpPortManager.h$>$}



Inheritance diagram for mdtModbusTcpPortManager:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=220pt]{classmdt_modbus_tcp_port_manager__inherit__graph}
\end{center}
\end{figure}


Collaboration diagram for mdtModbusTcpPortManager:\nopagebreak
\begin{figure}[H]
\begin{center}
\leavevmode
\includegraphics[width=254pt]{classmdt_modbus_tcp_port_manager__coll__graph}
\end{center}
\end{figure}
\subsection*{Public Slots}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}{fromThreadNewFrameReaden} ()
\begin{DoxyCompactList}\small\item\em Called by the thread whenn a complete frame was readen. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Public Member Functions}
\begin{DoxyCompactItemize}
\item 
\hyperlink{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}{mdtModbusTcpPortManager} (QObject $\ast$parent=0)
\begin{DoxyCompactList}\small\item\em Construct a MODBUS/TCP port manager. \end{DoxyCompactList}\item 
\hyperlink{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}{$\sim$mdtModbusTcpPortManager} ()
\begin{DoxyCompactList}\small\item\em Destructor. \end{DoxyCompactList}\item 
QList$<$ \hyperlink{classmdt_port_info}{mdtPortInfo} $\ast$ $>$ \hyperlink{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}{scan} (const QStringList \&hosts, int timeout=500)
\begin{DoxyCompactList}\small\item\em Scan for available hosts with a MODBUS/TCP compatible device attached. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_modbus_tcp_port_manager_ac83ea9c640869a4bccb4a4787697c646}{writeData} (QByteArray pdu, bool enqueueResponse=false)
\begin{DoxyCompactList}\small\item\em Write PDU by copy. \end{DoxyCompactList}\item 
int \hyperlink{classmdt_modbus_tcp_port_manager_a2a3ade6d3f9a6e7de47b9b089754288f}{writeData} (QByteArray pdu, \hyperlink{classmdt_port_transaction}{mdtPortTransaction} $\ast$transaction)
\begin{DoxyCompactList}\small\item\em Write PDU by copy. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
MODBUS/TCP port manager. 

This is the simplest way to use the MODBUS/TCP API.

All needed object are created by constructor. To alter configuration, use \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{config()}. To access the tcp port object, use port().

Use \hyperlink{classmdt_port_manager_af1fb103ffafc227337a59c7e82f44fbc}{start()} to begin read/write and stop to end.

References:
\begin{DoxyItemize}
\item MODBUS Application Protocol Specification V1.1b
\item \href{http://www.Modbus-IDA.org}{\tt http://www.Modbus-\/IDA.org} 
\end{DoxyItemize}

Definition at line 45 of file mdtModbusTcpPortManager.h.



\subsection{Constructor \& Destructor Documentation}
\hypertarget{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{mdtModbusTcpPortManager}]{\setlength{\rightskip}{0pt plus 5cm}mdtModbusTcpPortManager::mdtModbusTcpPortManager (
\begin{DoxyParamCaption}
\item[{QObject $\ast$}]{parent = {\ttfamily 0}}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a2f65f779bbad19d9d3f85ef35220ffb8}


Construct a MODBUS/TCP port manager. 

Creates a \hyperlink{classmdt_port_config}{mdtPortConfig}, a \hyperlink{classmdt_tcp_socket}{mdtTcpSocket}, and thread object. 

Definition at line 35 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!$\sim$mdtModbusTcpPortManager@{$\sim$mdtModbusTcpPortManager}}
\index{$\sim$mdtModbusTcpPortManager@{$\sim$mdtModbusTcpPortManager}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{$\sim$mdtModbusTcpPortManager}]{\setlength{\rightskip}{0pt plus 5cm}mdtModbusTcpPortManager::$\sim$mdtModbusTcpPortManager (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_aabe51a50a53c6b23884cc4862730b731}


Destructor. 

Stop the manager (if running), and close the port (if open). All internal objects (port, config and threads) are deleted here. 

Definition at line 59 of file mdtModbusTcpPortManager.cpp.



\subsection{Member Function Documentation}
\hypertarget{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!fromThreadNewFrameReaden@{fromThreadNewFrameReaden}}
\index{fromThreadNewFrameReaden@{fromThreadNewFrameReaden}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{fromThreadNewFrameReaden}]{\setlength{\rightskip}{0pt plus 5cm}void mdtModbusTcpPortManager::fromThreadNewFrameReaden (
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)\hspace{0.3cm}{\ttfamily  \mbox{[}virtual, slot\mbox{]}}}}
\label{classmdt_modbus_tcp_port_manager_ad941ea607f00db54aa6deb2866a539e9}


Called by the thread whenn a complete frame was readen. 



\begin{Desc}
\item[\hyperlink{todo__todo000023}{Todo}]Error on incomplete frame \end{Desc}




Reimplemented from \hyperlink{classmdt_port_manager_a4fcc8f0699b655156e661bb3de6056cc}{mdtPortManager}.



Definition at line 200 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!scan@{scan}}
\index{scan@{scan}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{scan}]{\setlength{\rightskip}{0pt plus 5cm}QList$<$ {\bf mdtPortInfo} $\ast$ $>$ mdtModbusTcpPortManager::scan (
\begin{DoxyParamCaption}
\item[{const QStringList \&}]{hosts, }
\item[{int}]{timeout = {\ttfamily 500}}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a216ee2495440be4eefb2faf9da3c9e47}


Scan for available hosts with a MODBUS/TCP compatible device attached. 


\begin{DoxyParams}{Parameters}
{\em hosts} & A list of hosts to scan. Each host must be set with format hostname:port, or ip:port. Note that MODBUS/TCP default port is 502. \\
\hline
{\em timeout} & Maximum wait time \mbox{[}ms\mbox{]}. Must be a multiple of 50 \mbox{[}ms\mbox{]}\\
\hline
\end{DoxyParams}
Note that returned list must be freed by user after usage. (for.ex. with qDeletAll() and QList::clear() ).

\begin{DoxyPrecond}{Precondition}
Manager must no running 
\end{DoxyPrecond}


Definition at line 67 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_a2a3ade6d3f9a6e7de47b9b089754288f}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!writeData@{writeData}}
\index{writeData@{writeData}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{writeData}]{\setlength{\rightskip}{0pt plus 5cm}int mdtModbusTcpPortManager::writeData (
\begin{DoxyParamCaption}
\item[{QByteArray}]{pdu, }
\item[{{\bf mdtPortTransaction} $\ast$}]{transaction}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_a2a3ade6d3f9a6e7de47b9b089754288f}


Write PDU by copy. 

Data will be encoded regarding MODBUS/TCP standard and passed to the mdtTcpSocket's write queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.

Internally, the transaction ID is incremented at each request and returned.


\begin{DoxyParams}{Parameters}
{\em pdu} & MODBUS PDU (see the MODBUS Application Protocol Specification for details) \\
\hline
{\em transaction} & A valid pointer to a \hyperlink{classmdt_port_transaction}{mdtPortTransaction} object. The id is set internally. If isQueryReplyMode is set true, transaction will be keeped in done queue until \hyperlink{classmdt_port_manager_a830ae182d06dd6a52c43a7f45b9240ac}{readenFrame(int)} is called. For all cases, signal \hyperlink{classmdt_port_manager_a915ff3372cccd5f412b828cc81a3381f}{newReadenFrame(mdtPortTransaction)} is emitted when data comes in. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Transaction ID on success. If the maximum of authorized transactions are reached, mdtAbstractPort::WriteQueueEmpty ($<$ 0) is returned. Note: internally, the writeFramesPool size of \hyperlink{classmdt_abstract_port}{mdtAbstractPort} is used to fix maximum transactions, and this is configurable in \hyperlink{classmdt_port_config}{mdtPortConfig}. See \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{mdtPortManager::config()} . 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{setPort()} before use of this method. 
\end{DoxyPrecond}


\begin{Desc}
\item[\hyperlink{todo__todo000022}{Todo}]Handle this ? \end{Desc}




Definition at line 165 of file mdtModbusTcpPortManager.cpp.

\hypertarget{classmdt_modbus_tcp_port_manager_ac83ea9c640869a4bccb4a4787697c646}{
\index{mdtModbusTcpPortManager@{mdtModbusTcpPortManager}!writeData@{writeData}}
\index{writeData@{writeData}!mdtModbusTcpPortManager@{mdtModbusTcpPortManager}}
\subsubsection[{writeData}]{\setlength{\rightskip}{0pt plus 5cm}int mdtModbusTcpPortManager::writeData (
\begin{DoxyParamCaption}
\item[{QByteArray}]{pdu, }
\item[{bool}]{enqueueResponse = {\ttfamily false}}
\end{DoxyParamCaption}
)}}
\label{classmdt_modbus_tcp_port_manager_ac83ea9c640869a4bccb4a4787697c646}


Write PDU by copy. 

\begin{Desc}
\item[\hyperlink{todo__todo000024}{Todo}]Obelete this version ! 

Obselete version with enqueueResponse \end{Desc}


Data will be encoded regarding MODBUS/TCP standard and passed to the mdtTcpSocket's write queue by copy. This method returns immediatly after enqueue, and don't wait until data was written.

Internally, the transaction ID is incremented at each request and returned.


\begin{DoxyParams}{Parameters}
{\em pdu} & MODBUS PDU (see the MODBUS Application Protocol Specification for details) \\
\hline
{\em enqueueResponse} & When data comes in,\\
\hline
\end{DoxyParams}
\begin{Desc}
\item[\hyperlink{todo__todo000025}{Todo}]SigName is emited. In blocking mode, data must (additionally) be enqueued until there are readen. So, for blocking mode (\char`\"{}script\char`\"{}), set this parameter true. \end{Desc}
\begin{DoxyReturn}{Returns}
Transaction ID on success. If the maximum of authorized transactions are reached, mdtAbstractPort::WriteQueueEmpty ($<$ 0) is returned. Note: internally, the writeFramesPool size of \hyperlink{classmdt_abstract_port}{mdtAbstractPort} is used to fix maximum transactions, and this is configurable in \hyperlink{classmdt_port_config}{mdtPortConfig}. See \hyperlink{classmdt_port_manager_a9cf3ea2da38f81682695b37448712ffd}{mdtPortManager::config()} . 
\end{DoxyReturn}
\begin{DoxyPrecond}{Precondition}
Port must be set with \hyperlink{classmdt_port_manager_afcd156b2d0c9d340999935efb6cd8cb6}{setPort()} before use of this method.
\end{DoxyPrecond}
\begin{Desc}
\item[\hyperlink{todo__todo000026}{Todo}]Delete default enqueueResponse ! \end{Desc}


frame-\/$>$setWaitAnAnswer(false);

\begin{Desc}
\item[\hyperlink{todo__todo000021}{Todo}]Handle this ? \end{Desc}


addTransaction(transaction); 



Definition at line 131 of file mdtModbusTcpPortManager.cpp.



The documentation for this class was generated from the following files:\begin{DoxyCompactItemize}
\item 
src/mdtport/mdtModbusTcpPortManager.h\item 
src/mdtport/mdtModbusTcpPortManager.cpp\end{DoxyCompactItemize}
